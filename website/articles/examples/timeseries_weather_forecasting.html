<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Timeseries forecasting for weather prediction • keras</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<script src="../../extra.js"></script><meta property="og:title" content="Timeseries forecasting for weather prediction">
<meta property="og:description" content="This notebook demonstrates how to do timeseries forecasting using a LSTM model.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">keras</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.13.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/getting_started.html">Getting Started</a>
    </li>
    <li>
      <a href="../../articles/tutorial_basic_classification.html">Basic Classification</a>
    </li>
    <li>
      <a href="../../articles/tutorial_basic_text_classification.html">Text Classification</a>
    </li>
    <li>
      <a href="../../articles/tutorial_basic_regression.html">Basic Regression</a>
    </li>
    <li>
      <a href="../../articles/tutorial_overfit_underfit.html">Overfitting and Underfitting</a>
    </li>
    <li>
      <a href="../../articles/tutorial_save_and_restore.html">Save and Restore Models</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Guides (New for TF 2.6)</li>
    <li>
      <a href="../../articles/new-guides/python_subclasses.html">Python Subclasses</a>
    </li>
    <li>
      <a href="../../articles/new-guides/making_new_layers_and_models_via_subclassing.html">Making New Layers and Models via Subclassing</a>
    </li>
    <li>
      <a href="../../articles/new-guides/customizing_what_happens_in_fit.html">Customizing What Happens in Fit</a>
    </li>
    <li>
      <a href="../../articles/new-guides/writing_your_own_callbacks.html">Writing Your Own Callbacks</a>
    </li>
    <li>
      <a href="../../articles/new-guides/preprocessing_layers.html">Working with Preprocessing Layers</a>
    </li>
    <li>
      <a href="../../argicles/new-guides/working_with_rnns.html">Working with RNNs</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Using Keras</li>
    <li>
      <a href="../../articles/guide_keras.html">Guide to Keras Basics</a>
    </li>
    <li>
      <a href="../../articles/sequential_model.html">Sequential Model in Depth</a>
    </li>
    <li>
      <a href="../../articles/functional_api.html">Functional API in Depth</a>
    </li>
    <li>
      <a href="../../articles/about_keras_models.html">About Keras Models</a>
    </li>
    <li>
      <a href="../../articles/about_keras_layers.html">About Keras Layers</a>
    </li>
    <li>
      <a href="../../articles/training_visualization.html">Training Visualization</a>
    </li>
    <li>
      <a href="../../articles/applications.html">Pre-Trained Models</a>
    </li>
    <li>
      <a href="../../articles/faq.html">Frequently Asked Questions</a>
    </li>
    <li>
      <a href="../../articles/why_use_keras.html">Why Use Keras?</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Advanced</li>
    <li>
      <a href="../../articles/eager_guide.html">Eager Execution</a>
    </li>
    <li>
      <a href="../../articles/training_callbacks.html">Training Callbacks</a>
    </li>
    <li>
      <a href="../../articles/backend.html">Keras Backend</a>
    </li>
    <li>
      <a href="../../articles/custom_layers.html">Custom Layers</a>
    </li>
    <li>
      <a href="../../articles/custom_models.html">Custom Models</a>
    </li>
    <li>
      <a href="../../articles/saving_serializing.html">Saving and serializing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../articles/learn.html">Learn</a>
</li>
<li>
  <a href="../../articles/tools.html">Tools</a>
</li>
<li>
  <a href="../../articles/examples/index.html">Examples</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rstudio/keras/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Timeseries forecasting for weather
prediction</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/keras/blob/HEAD/vignettes/examples/timeseries_weather_forecasting.Rmd" class="external-link"><code>vignettes/examples/timeseries_weather_forecasting.Rmd</code></a></small>
      <div class="hidden name"><code>timeseries_weather_forecasting.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>This example requires TensorFlow 2.3 or higher.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="im">import</span> keras <span class="im">as</span> keras</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="climate-data-time-series">Climate Data Time-Series<a class="anchor" aria-label="anchor" href="#climate-data-time-series"></a>
</h3>
<p>We will be using Jena Climate dataset recorded by the <a href="https://www.bgc-jena.mpg.de/wetter/" class="external-link">Max Planck Institute for
Biogeochemistry</a>. The dataset consists of 14 features such as
temperature, pressure, humidity etc, recorded once per 10 minutes.</p>
<p><strong>Location</strong>: Weather Station, Max Planck Institute for
Biogeochemistry in Jena, Germany</p>
<p><strong>Time-frame Considered</strong>: Jan 10, 2009 - December 31,
2016</p>
<p>The table below shows the column names, their value formats, and
their description.</p>
<table class="table">
<colgroup>
<col width="8%">
<col width="24%">
<col width="30%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th>Index</th>
<th>Features</th>
<th>Format</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Date Time</td>
<td>01.01.2009 00:10:00</td>
<td>Date-time reference</td>
</tr>
<tr class="even">
<td>2</td>
<td>p (mbar)</td>
<td>996.52</td>
<td>The pascal SI derived unit of pressure used to quantify internal
pressure. Meteorological reports typically state atmospheric pressure in
millibars.</td>
</tr>
<tr class="odd">
<td>3</td>
<td>T (degC)</td>
<td>-8.02</td>
<td>Temperature in Celsius</td>
</tr>
<tr class="even">
<td>4</td>
<td>Tpot (K)</td>
<td>265.4</td>
<td>Temperature in Kelvin</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Tdew (degC)</td>
<td>-8.9</td>
<td>Temperature in Celsius relative to humidity. Dew Point is a measure
of the absolute amount of water in the air, the DP is the temperature at
which the air cannot hold all the moisture in it and water
condenses.</td>
</tr>
<tr class="even">
<td>6</td>
<td>rh (%)</td>
<td>93.3</td>
<td>Relative Humidity is a measure of how saturated the air is with
water vapor, the %RH determines the amount of water contained within
collection objects.</td>
</tr>
<tr class="odd">
<td>7</td>
<td>VPmax (mbar)</td>
<td>3.33</td>
<td>Saturation vapor pressure</td>
</tr>
<tr class="even">
<td>8</td>
<td>VPact (mbar)</td>
<td>3.11</td>
<td>Vapor pressure</td>
</tr>
<tr class="odd">
<td>9</td>
<td>VPdef (mbar)</td>
<td>0.22</td>
<td>Vapor pressure deficit</td>
</tr>
<tr class="even">
<td>10</td>
<td>sh (g/kg)</td>
<td>1.94</td>
<td>Specific humidity</td>
</tr>
<tr class="odd">
<td>11</td>
<td>H2OC (mmol/mol)</td>
<td>3.12</td>
<td>Water vapor concentration</td>
</tr>
<tr class="even">
<td>12</td>
<td>rho (g/m ** 3)</td>
<td>1307.75</td>
<td>Airtight</td>
</tr>
<tr class="odd">
<td>13</td>
<td>wv (m/s)</td>
<td>1.03</td>
<td>Wind speed</td>
</tr>
<tr class="even">
<td>14</td>
<td>max. wv (m/s)</td>
<td>1.75</td>
<td>Maximum wind speed</td>
</tr>
<tr class="odd">
<td>15</td>
<td>wd (deg)</td>
<td>152.3</td>
<td>Wind direction in degrees</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">from</span> zipfile <span class="im">import</span> ZipFile</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>uri <span class="op">=</span> <span class="st">"https://storage.googleapis.com/tensorflow/tf-keras-datasets/jena_climate_2009_2016.csv.zip"</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>zip_path <span class="op">=</span> keras.utils.get_file(</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    origin<span class="op">=</span>uri, fname<span class="op">=</span><span class="st">"jena_climate_2009_2016.csv.zip"</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>zip_file <span class="op">=</span> ZipFile(zip_path)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>zip_file.extractall()</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>csv_path <span class="op">=</span> <span class="st">"jena_climate_2009_2016.csv"</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(csv_path)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="raw-data-visualization">Raw Data Visualization<a class="anchor" aria-label="anchor" href="#raw-data-visualization"></a>
</h3>
<p>To give us a sense of the data we are working with, each feature has
been plotted below. This shows the distinct pattern of each feature over
the time period from 2009 to 2016. It also shows where anomalies are
present, which will be addressed during normalization.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>titles <span class="op">=</span> [</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="st">"Pressure"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="st">"Temperature"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>    <span class="st">"Temperature in Kelvin"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="st">"Temperature (dew point)"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="st">"Relative Humidity"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="st">"Saturation vapor pressure"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    <span class="st">"Vapor pressure"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>    <span class="st">"Vapor pressure deficit"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>    <span class="st">"Specific humidity"</span>,</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    <span class="st">"Water vapor concentration"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>    <span class="st">"Airtight"</span>,</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>    <span class="st">"Wind speed"</span>,</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>    <span class="st">"Maximum wind speed"</span>,</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>    <span class="st">"Wind direction in degrees"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>]</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>feature_keys <span class="op">=</span> [</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>    <span class="st">"p (mbar)"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>    <span class="st">"T (degC)"</span>,</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>    <span class="st">"Tpot (K)"</span>,</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>    <span class="st">"Tdew (degC)"</span>,</span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>    <span class="st">"rh (%)"</span>,</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>    <span class="st">"VPmax (mbar)"</span>,</span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>    <span class="st">"VPact (mbar)"</span>,</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>    <span class="st">"VPdef (mbar)"</span>,</span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>    <span class="st">"sh (g/kg)"</span>,</span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>    <span class="st">"H2OC (mmol/mol)"</span>,</span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>    <span class="st">"rho (g/m**3)"</span>,</span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>    <span class="st">"wv (m/s)"</span>,</span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>    <span class="st">"max. wv (m/s)"</span>,</span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>    <span class="st">"wd (deg)"</span>,</span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>]</span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>colors <span class="op">=</span> [</span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a>    <span class="st">"blue"</span>,</span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>    <span class="st">"orange"</span>,</span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>    <span class="st">"green"</span>,</span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>    <span class="st">"red"</span>,</span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a>    <span class="st">"purple"</span>,</span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a>    <span class="st">"brown"</span>,</span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a>    <span class="st">"pink"</span>,</span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a>    <span class="st">"gray"</span>,</span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a>    <span class="st">"olive"</span>,</span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a>    <span class="st">"cyan"</span>,</span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a>]</span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a>date_time_key <span class="op">=</span> <span class="st">"Date Time"</span></span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a></span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a><span class="kw">def</span> show_raw_visualization(data):</span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a>    time_data <span class="op">=</span> data[date_time_key]</span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(</span>
<span id="cb3-54"><a href="#cb3-54" tabindex="-1"></a>        nrows<span class="op">=</span><span class="dv">7</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">20</span>), dpi<span class="op">=</span><span class="dv">80</span>, facecolor<span class="op">=</span><span class="st">"w"</span>, edgecolor<span class="op">=</span><span class="st">"k"</span></span>
<span id="cb3-55"><a href="#cb3-55" tabindex="-1"></a>    )</span>
<span id="cb3-56"><a href="#cb3-56" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(feature_keys)):</span>
<span id="cb3-57"><a href="#cb3-57" tabindex="-1"></a>        key <span class="op">=</span> feature_keys[i]</span>
<span id="cb3-58"><a href="#cb3-58" tabindex="-1"></a>        c <span class="op">=</span> colors[i <span class="op">%</span> (<span class="bu">len</span>(colors))]</span>
<span id="cb3-59"><a href="#cb3-59" tabindex="-1"></a>        t_data <span class="op">=</span> data[key]</span>
<span id="cb3-60"><a href="#cb3-60" tabindex="-1"></a>        t_data.index <span class="op">=</span> time_data</span>
<span id="cb3-61"><a href="#cb3-61" tabindex="-1"></a>        t_data.head()</span>
<span id="cb3-62"><a href="#cb3-62" tabindex="-1"></a>        ax <span class="op">=</span> t_data.plot(</span>
<span id="cb3-63"><a href="#cb3-63" tabindex="-1"></a>            ax<span class="op">=</span>axes[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>],</span>
<span id="cb3-64"><a href="#cb3-64" tabindex="-1"></a>            color<span class="op">=</span>c,</span>
<span id="cb3-65"><a href="#cb3-65" tabindex="-1"></a>            title<span class="op">=</span><span class="st">"</span><span class="sc">{}</span><span class="st"> - </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(titles[i], key),</span>
<span id="cb3-66"><a href="#cb3-66" tabindex="-1"></a>            rot<span class="op">=</span><span class="dv">25</span>,</span>
<span id="cb3-67"><a href="#cb3-67" tabindex="-1"></a>        )</span>
<span id="cb3-68"><a href="#cb3-68" tabindex="-1"></a>        ax.legend([titles[i]])</span>
<span id="cb3-69"><a href="#cb3-69" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb3-70"><a href="#cb3-70" tabindex="-1"></a></span>
<span id="cb3-71"><a href="#cb3-71" tabindex="-1"></a></span>
<span id="cb3-72"><a href="#cb3-72" tabindex="-1"></a>show_raw_visualization(df)</span></code></pre></div>
<p>This heat map shows the correlation between different features.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">def</span> show_heatmap(data):</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    plt.matshow(data.corr())</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    plt.xticks(<span class="bu">range</span>(data.shape[<span class="dv">1</span>]), data.columns, fontsize<span class="op">=</span><span class="dv">14</span>, rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    plt.gca().xaxis.tick_bottom()</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    plt.yticks(<span class="bu">range</span>(data.shape[<span class="dv">1</span>]), data.columns, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>    cb <span class="op">=</span> plt.colorbar()</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    cb.ax.tick_params(labelsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    plt.title(<span class="st">"Feature Correlation Heatmap"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>    plt.show()</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>show_heatmap(df)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-preprocessing">Data Preprocessing<a class="anchor" aria-label="anchor" href="#data-preprocessing"></a>
</h3>
<p>Here we are picking ~300,000 data points for training. Observation is
recorded every 10 mins, that means 6 times per hour. We will resample
one point per hour since no drastic change is expected within 60
minutes. We do this via the <code>sampling_rate</code> argument in
<code>timeseries_dataset_from_array</code> utility.</p>
<p>We are tracking data from past 720 timestamps (720/6=120 hours). This
data will be used to predict the temperature after 72 timestamps
(72/6=12 hours).</p>
<p>Since every feature has values with varying ranges, we do
normalization to confine feature values to a range of
<code>[0, 1]</code> before training a neural network. We do this by
subtracting the mean and dividing by the standard deviation of each
feature.</p>
<p>71.5 % of the data will be used to train the model, i.e. 300,693
rows. <code>split_fraction</code> can be changed to alter this
percentage.</p>
<p>The model is shown data for first 5 days i.e. 720 observations, that
are sampled every hour. The temperature after 72 (12 hours * 6
observation per hour) observation will be used as a label.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>split_fraction <span class="op">=</span> <span class="fl">0.715</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>train_split <span class="op">=</span> <span class="bu">int</span>(split_fraction <span class="op">*</span> <span class="bu">int</span>(df.shape[<span class="dv">0</span>]))</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>step <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>past <span class="op">=</span> <span class="dv">720</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>future <span class="op">=</span> <span class="dv">72</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>learning_rate <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>batch_size <span class="op">=</span> <span class="dv">256</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>epochs <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="kw">def</span> normalize(data, train_split):</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>    data_mean <span class="op">=</span> data[:train_split].mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>    data_std <span class="op">=</span> data[:train_split].std(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>    <span class="cf">return</span> (data <span class="op">-</span> data_mean) <span class="op">/</span> data_std</span></code></pre></div>
<p>We can see from the correlation heatmap, few parameters like Relative
Humidity and Specific Humidity are redundant. Hence we will be using
select features, not all.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>    <span class="st">"The selected parameters are:"</span>,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="st">", "</span>.join([titles[i] <span class="cf">for</span> i <span class="kw">in</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">11</span>]]),</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>selected_features <span class="op">=</span> [feature_keys[i] <span class="cf">for</span> i <span class="kw">in</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">11</span>]]</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>features <span class="op">=</span> df[selected_features]</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>features.index <span class="op">=</span> df[date_time_key]</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>features.head()</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>features <span class="op">=</span> normalize(features.values, train_split)</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>features <span class="op">=</span> pd.DataFrame(features)</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>features.head()</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>train_data <span class="op">=</span> features.loc[<span class="dv">0</span> : train_split <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>val_data <span class="op">=</span> features.loc[train_split:]</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="training-dataset">Training dataset<a class="anchor" aria-label="anchor" href="#training-dataset"></a>
</h2>
<p>The training dataset labels starts from the 792nd observation (720 +
72).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>start <span class="op">=</span> past <span class="op">+</span> future</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>end <span class="op">=</span> start <span class="op">+</span> train_split</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>x_train <span class="op">=</span> train_data[[i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)]].values</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>y_train <span class="op">=</span> features.iloc[start:end][[<span class="dv">1</span>]]</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>sequence_length <span class="op">=</span> <span class="bu">int</span>(past <span class="op">/</span> step)</span></code></pre></div>
<p>The <code>timeseries_dataset_from_array</code> function takes in a
sequence of data-points gathered at equal intervals, along with time
series parameters such as length of the sequences/windows, spacing
between two sequence/windows, etc., to produce batches of sub-timeseries
inputs and targets sampled from the main timeseries.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>dataset_train <span class="op">=</span> keras.preprocessing.timeseries_dataset_from_array(</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    x_train,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    y_train,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>    sequence_length<span class="op">=</span>sequence_length,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    sampling_rate<span class="op">=</span>step,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>)</span></code></pre></div>
<div class="section level3">
<h3 id="validation-dataset">Validation dataset<a class="anchor" aria-label="anchor" href="#validation-dataset"></a>
</h3>
<p>The validation dataset must not contain the last 792 rows as we won’t
have label data for those records, hence 792 must be subtracted from the
end of the data.</p>
<p>The validation label dataset must start from 792 after train_split,
hence we must add past + future (792) to label_start.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>x_end <span class="op">=</span> <span class="bu">len</span>(val_data) <span class="op">-</span> past <span class="op">-</span> future</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>label_start <span class="op">=</span> train_split <span class="op">+</span> past <span class="op">+</span> future</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>x_val <span class="op">=</span> val_data.iloc[:x_end][[i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)]].values</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>y_val <span class="op">=</span> features.iloc[label_start:][[<span class="dv">1</span>]]</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>dataset_val <span class="op">=</span> keras.preprocessing.timeseries_dataset_from_array(</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>    x_val,</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>    y_val,</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>    sequence_length<span class="op">=</span>sequence_length,</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>    sampling_rate<span class="op">=</span>step,</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>)</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="cf">for</span> batch <span class="kw">in</span> dataset_train.take(<span class="dv">1</span>):</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>    inputs, targets <span class="op">=</span> batch</span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Input shape:"</span>, inputs.numpy().shape)</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Target shape:"</span>, targets.numpy().shape)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="training">Training<a class="anchor" aria-label="anchor" href="#training"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>inputs <span class="op">=</span> keras.layers.Input(shape<span class="op">=</span>(inputs.shape[<span class="dv">1</span>], inputs.shape[<span class="dv">2</span>]))</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>lstm_out <span class="op">=</span> keras.layers.LSTM(<span class="dv">32</span>)(inputs)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>outputs <span class="op">=</span> keras.layers.Dense(<span class="dv">1</span>)(lstm_out)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>model <span class="op">=</span> keras.Model(inputs<span class="op">=</span>inputs, outputs<span class="op">=</span>outputs)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>model.<span class="bu">compile</span>(</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    optimizer<span class="op">=</span>keras.optimizers.Adam(learning_rate<span class="op">=</span>learning_rate), loss<span class="op">=</span><span class="st">"mse"</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>)</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>model.summary()</span></code></pre></div>
<p>We’ll use the <code>ModelCheckpoint</code> callback to regularly save
checkpoints, and the <code>EarlyStopping</code> callback to interrupt
training when the validation loss is not longer improving.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>path_checkpoint <span class="op">=</span> <span class="st">"model_checkpoint.weights.h5"</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>es_callback <span class="op">=</span> keras.callbacks.EarlyStopping(</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    monitor<span class="op">=</span><span class="st">"val_loss"</span>, min_delta<span class="op">=</span><span class="dv">0</span>, patience<span class="op">=</span><span class="dv">5</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>modelckpt_callback <span class="op">=</span> keras.callbacks.ModelCheckpoint(</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    monitor<span class="op">=</span><span class="st">"val_loss"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>    filepath<span class="op">=</span>path_checkpoint,</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    verbose<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>    save_weights_only<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>    save_best_only<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>)</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>    dataset_train,</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>    epochs<span class="op">=</span>epochs,</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>    validation_data<span class="op">=</span>dataset_val,</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>    callbacks<span class="op">=</span>[es_callback, modelckpt_callback],</span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>)</span></code></pre></div>
<p>We can visualize the loss with the function below. After one point,
the loss stops decreasing.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="kw">def</span> visualize_loss(history, title):</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>    loss <span class="op">=</span> history.history[<span class="st">"loss"</span>]</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    val_loss <span class="op">=</span> history.history[<span class="st">"val_loss"</span>]</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    epochs <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(loss))</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    plt.figure()</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    plt.plot(epochs, loss, <span class="st">"b"</span>, label<span class="op">=</span><span class="st">"Training loss"</span>)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>    plt.plot(epochs, val_loss, <span class="st">"r"</span>, label<span class="op">=</span><span class="st">"Validation loss"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>    plt.title(title)</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>    plt.xlabel(<span class="st">"Epochs"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>    plt.ylabel(<span class="st">"Loss"</span>)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>    plt.legend()</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>    plt.show()</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>visualize_loss(history, <span class="st">"Training and Validation Loss"</span>)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h3>
<p>The trained model above is now able to make predictions for 5 sets of
values from validation set.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="kw">def</span> show_plot(plot_data, delta, title):</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>    labels <span class="op">=</span> [<span class="st">"History"</span>, <span class="st">"True Future"</span>, <span class="st">"Model Prediction"</span>]</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    marker <span class="op">=</span> [<span class="st">".-"</span>, <span class="st">"rx"</span>, <span class="st">"go"</span>]</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    time_steps <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="op">-</span>(plot_data[<span class="dv">0</span>].shape[<span class="dv">0</span>]), <span class="dv">0</span>))</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>    <span class="cf">if</span> delta:</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>        future <span class="op">=</span> delta</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>        future <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>    plt.title(title)</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>    <span class="cf">for</span> i, val <span class="kw">in</span> <span class="bu">enumerate</span>(plot_data):</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>        <span class="cf">if</span> i:</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>            plt.plot(</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>                future, plot_data[i], marker[i], markersize<span class="op">=</span><span class="dv">10</span>, label<span class="op">=</span>labels[i]</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>            )</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>            plt.plot(</span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>                time_steps, plot_data[i].flatten(), marker[i], label<span class="op">=</span>labels[i]</span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>            )</span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>    plt.legend()</span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>    plt.xlim([time_steps[<span class="dv">0</span>], (future <span class="op">+</span> <span class="dv">5</span>) <span class="op">*</span> <span class="dv">2</span>])</span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>    plt.xlabel(<span class="st">"Time-Step"</span>)</span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a>    plt.show()</span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a><span class="cf">for</span> x, y <span class="kw">in</span> dataset_val.take(<span class="dv">5</span>):</span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a>    show_plot(</span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a>        [x[<span class="dv">0</span>][:, <span class="dv">1</span>].numpy(), y[<span class="dv">0</span>].numpy(), model.predict(x)[<span class="dv">0</span>]],</span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a>        <span class="dv">12</span>,</span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a>        <span class="st">"Single Step Prediction"</span>,</span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a>    )</span></code></pre></div>
<p><strong>Example available on HuggingFace</strong> | Trained Model |
Demo | | :–: | :–: | | <a href="https://huggingface.co/keras-io/timeseries_forecasting_for_weather" class="external-link"><img src="https://img.shields.io/badge/%F0%9F%A4%97%20Model-Time%20Series-black.svg" alt="Generic badge"></a> | <a href="https://huggingface.co/spaces/keras-io/timeseries_forecasting_for_weather" class="external-link"><img src="https://img.shields.io/badge/%F0%9F%A4%97%20Spaces-Time%20Series-black.svg" alt="Generic badge"></a> |</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tomasz Kalinowski, JJ Allaire, François Chollet, RStudio, Google.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

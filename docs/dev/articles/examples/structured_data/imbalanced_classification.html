<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Imbalanced classification: credit card fraud detection • keras3</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../../../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../../../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../../../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../../../favicon.ico">
<link rel="manifest" href="../../../site.webmanifest">
<script src="../../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../../deps/search-1.0.0/fuse.min.js"></script><script src="../../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../../pkgdown.js"></script><link href="../../../extra.css" rel="stylesheet">
<meta property="og:title" content="Imbalanced classification: credit card fraud detection">
<meta name="description" content="Demonstration of how to handle highly imbalanced classification problems.">
<meta property="og:description" content="Demonstration of how to handle highly imbalanced classification problems.">
<meta name="robots" content="noindex">
<!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KHBDBW7');</script><!-- End Google Tag Manager -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KHBDBW7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) -->


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="inverse" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../../index.html">keras3</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../../articles/getting_started.html">Getting Started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-guides">
<li><h6 class="dropdown-header" data-toc-skip>Model definition</h6></li>
    <li><a class="dropdown-item" href="../../../articles/sequential_model.html">Sequential Model</a></li>
    <li><a class="dropdown-item" href="../../../articles/functional_api.html">Functional API</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending and customizing</h6></li>
    <li><a class="dropdown-item" href="../../../articles/training_with_built_in_methods.html">Training &amp; evaluation with the built-in methods</a></li>
    <li><a class="dropdown-item" href="../../../articles/custom_train_step_in_tensorflow.html">Customizing `fit()` with Tensorflow</a></li>
    <li><a class="dropdown-item" href="../../../articles/writing_your_own_callbacks.html">Writing your own callbacks</a></li>
    <li><a class="dropdown-item" href="../../../articles/making_new_layers_and_models_via_subclassing.html">Making new layers and models via subclassing</a></li>
    <li><a class="dropdown-item" href="../../../articles/writing_a_custom_training_loop_in_tensorflow.html">Writing a training loop from scratch in TensorFlow</a></li>
    <li><a class="dropdown-item" href="../../../articles/serialization_and_saving.html">Serialization and Saving</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other topics</h6></li>
    <li><a class="dropdown-item" href="../../../articles/transfer_learning.html">Transfer learning and fine tuning</a></li>
    <li><a class="dropdown-item" href="../../../articles/distributed_training_with_tensorflow.html">Distributed training with TensorFlow</a></li>
    <li><a class="dropdown-item" href="../../../articles/distribution.html">Distributed training with Jax</a></li>
  </ul>
</li>
<li class="active nav-item"><a class="nav-link" href="../../../articles/examples/index.html">Examples</a></li>
<li class="nav-item"><a class="nav-link" href="../../../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../../../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/keras3/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Imbalanced classification: credit card fraud detection</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/keras3/blob/HEAD/vignettes/examples/structured_data/imbalanced_classification.Rmd" class="external-link"><code>vignettes/examples/structured_data/imbalanced_classification.Rmd</code></a></small>
      <div class="d-none name"><code>imbalanced_classification.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://keras3.posit.co/">keras3</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../../../reference/use_backend.html">use_backend</a></span><span class="op">(</span><span class="st">"jax"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This example looks at the <a href="https://www.kaggle.com/mlg-ulb/creditcardfraud/" class="external-link">Kaggle Credit
Card Fraud Detection</a> dataset to demonstrate how to train a
classification model on data with highly imbalanced classes. You can
download the data by clicking “Download” at the link, or if you’re setup
with a kaggle API key at <code>"~/.kaggle/kagle.json"</code>, you can
run the following:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_install.html" class="external-link">py_install</a></span><span class="op">(</span><span class="st">"kaggle"</span>, pip <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_available.html" class="external-link">py_available</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># ensure 'kaggle' is on the PATH</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"kaggle datasets download -d mlg-ulb/creditcardfraud"</span><span class="op">)</span></span>
<span><span class="fu">zip</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/zip/reference/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"creditcardfraud.zip"</span>, files <span class="op">=</span> <span class="st">"creditcard.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="first-load-the-data">First, load the data<a class="anchor" aria-label="anchor" href="#first-load-the-data"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"creditcard.csv"</span>, col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html" class="external-link">cols</a></span><span class="op">(</span></span>
<span>  Class <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html" class="external-link">col_integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  .default <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html" class="external-link">col_double</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 284,807</span></span>
<span><span class="co">## Columns: 31</span></span>
<span><span class="co">## $ Time   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>1<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>7<span style="color: #949494;">, </span>7<span style="color: #949494;">, </span>9<span style="color: #949494;">, </span>10<span style="color: #949494;">, </span>10<span style="color: #949494;">, </span>10<span style="color: #949494;">, </span>11<span style="color: #949494;">, </span>12<span style="color: #949494;">, </span>12<span style="color: #949494;">, </span>12<span style="color: #949494;">, </span>1…</span></span>
<span><span class="co">## $ V1     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -1.3598071<span style="color: #949494;">, </span>1.1918571<span style="color: #949494;">, </span>-1.3583541<span style="color: #949494;">, </span>-0.9662717<span style="color: #949494;">, </span>-1.1582331<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">## $ V2     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.07278117<span style="color: #949494;">, </span>0.26615071<span style="color: #949494;">, </span>-1.34016307<span style="color: #949494;">, </span>-0.18522601<span style="color: #949494;">, </span>0.877736…</span></span>
<span><span class="co">## $ V3     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.53634674<span style="color: #949494;">, </span>0.16648011<span style="color: #949494;">, </span>1.77320934<span style="color: #949494;">, </span>1.79299334<span style="color: #949494;">, </span>1.54871785<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">## $ V4     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.37815522<span style="color: #949494;">, </span>0.44815408<span style="color: #949494;">, </span>0.37977959<span style="color: #949494;">, </span>-0.86329128<span style="color: #949494;">, </span>0.40303393…</span></span>
<span><span class="co">## $ V5     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.33832077<span style="color: #949494;">, </span>0.06001765<span style="color: #949494;">, </span>-0.50319813<span style="color: #949494;">, </span>-0.01030888<span style="color: #949494;">, </span>-0.40719…</span></span>
<span><span class="co">## $ V6     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.46238778<span style="color: #949494;">, </span>-0.08236081<span style="color: #949494;">, </span>1.80049938<span style="color: #949494;">, </span>1.24720317<span style="color: #949494;">, </span>0.09592146…</span></span>
<span><span class="co">## $ V7     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.239598554<span style="color: #949494;">, </span>-0.078802983<span style="color: #949494;">, </span>0.791460956<span style="color: #949494;">, </span>0.237608940<span style="color: #949494;">, </span>0.5929…</span></span>
<span><span class="co">## $ V8     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.098697901<span style="color: #949494;">, </span>0.085101655<span style="color: #949494;">, </span>0.247675787<span style="color: #949494;">, </span>0.377435875<span style="color: #949494;">, </span>-0.2705…</span></span>
<span><span class="co">## $ V9     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.3637870<span style="color: #949494;">, </span>-0.2554251<span style="color: #949494;">, </span>-1.5146543<span style="color: #949494;">, </span>-1.3870241<span style="color: #949494;">, </span>0.8177393<span style="color: #949494;">, </span>-…</span></span>
<span><span class="co">## $ V10    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.09079417<span style="color: #949494;">, </span>-0.16697441<span style="color: #949494;">, </span>0.20764287<span style="color: #949494;">, </span>-0.05495192<span style="color: #949494;">, </span>0.7530744…</span></span>
<span><span class="co">## $ V11    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.55159953<span style="color: #949494;">, </span>1.61272666<span style="color: #949494;">, </span>0.62450146<span style="color: #949494;">, </span>-0.22648726<span style="color: #949494;">, </span>-0.822842…</span></span>
<span><span class="co">## $ V12    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.61780086<span style="color: #949494;">, </span>1.06523531<span style="color: #949494;">, </span>0.06608369<span style="color: #949494;">, </span>0.17822823<span style="color: #949494;">, </span>0.53819555…</span></span>
<span><span class="co">## $ V13    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.99138985<span style="color: #949494;">, </span>0.48909502<span style="color: #949494;">, </span>0.71729273<span style="color: #949494;">, </span>0.50775687<span style="color: #949494;">, </span>1.34585159…</span></span>
<span><span class="co">## $ V14    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.31116935<span style="color: #949494;">, </span>-0.14377230<span style="color: #949494;">, </span>-0.16594592<span style="color: #949494;">, </span>-0.28792375<span style="color: #949494;">, </span>-1.1196…</span></span>
<span><span class="co">## $ V15    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.468176972<span style="color: #949494;">, </span>0.635558093<span style="color: #949494;">, </span>2.345864949<span style="color: #949494;">, </span>-0.631418118<span style="color: #949494;">, </span>0.1751…</span></span>
<span><span class="co">## $ V16    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.47040053<span style="color: #949494;">, </span>0.46391704<span style="color: #949494;">, </span>-2.89008319<span style="color: #949494;">, </span>-1.05964725<span style="color: #949494;">, </span>-0.45144…</span></span>
<span><span class="co">## $ V17    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.207971242<span style="color: #949494;">, </span>-0.114804663<span style="color: #949494;">, </span>1.109969379<span style="color: #949494;">, </span>-0.684092786<span style="color: #949494;">, </span>-0.23…</span></span>
<span><span class="co">## $ V18    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.02579058<span style="color: #949494;">, </span>-0.18336127<span style="color: #949494;">, </span>-0.12135931<span style="color: #949494;">, </span>1.96577500<span style="color: #949494;">, </span>-0.038194…</span></span>
<span><span class="co">## $ V19    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.40399296<span style="color: #949494;">, </span>-0.14578304<span style="color: #949494;">, </span>-2.26185710<span style="color: #949494;">, </span>-1.23262197<span style="color: #949494;">, </span>0.803486…</span></span>
<span><span class="co">## $ V20    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.25141210<span style="color: #949494;">, </span>-0.06908314<span style="color: #949494;">, </span>0.52497973<span style="color: #949494;">, </span>-0.20803778<span style="color: #949494;">, </span>0.4085423…</span></span>
<span><span class="co">## $ V21    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.018306778<span style="color: #949494;">, </span>-0.225775248<span style="color: #949494;">, </span>0.247998153<span style="color: #949494;">, </span>-0.108300452<span style="color: #949494;">, </span>-0.0…</span></span>
<span><span class="co">## $ V22    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.277837576<span style="color: #949494;">, </span>-0.638671953<span style="color: #949494;">, </span>0.771679402<span style="color: #949494;">, </span>0.005273597<span style="color: #949494;">, </span>0.7982…</span></span>
<span><span class="co">## $ V23    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.110473910<span style="color: #949494;">, </span>0.101288021<span style="color: #949494;">, </span>0.909412262<span style="color: #949494;">, </span>-0.190320519<span style="color: #949494;">, </span>-0.13…</span></span>
<span><span class="co">## $ V24    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.06692807<span style="color: #949494;">, </span>-0.33984648<span style="color: #949494;">, </span>-0.68928096<span style="color: #949494;">, </span>-1.17557533<span style="color: #949494;">, </span>0.141266…</span></span>
<span><span class="co">## $ V25    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.12853936<span style="color: #949494;">, </span>0.16717040<span style="color: #949494;">, </span>-0.32764183<span style="color: #949494;">, </span>0.64737603<span style="color: #949494;">, </span>-0.2060095…</span></span>
<span><span class="co">## $ V26    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.18911484<span style="color: #949494;">, </span>0.12589453<span style="color: #949494;">, </span>-0.13909657<span style="color: #949494;">, </span>-0.22192884<span style="color: #949494;">, </span>0.502292…</span></span>
<span><span class="co">## $ V27    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.133558377<span style="color: #949494;">, </span>-0.008983099<span style="color: #949494;">, </span>-0.055352794<span style="color: #949494;">, </span>0.062722849<span style="color: #949494;">, </span>0.219…</span></span>
<span><span class="co">## $ V28    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.021053053<span style="color: #949494;">, </span>0.014724169<span style="color: #949494;">, </span>-0.059751841<span style="color: #949494;">, </span>0.061457629<span style="color: #949494;">, </span>0.215…</span></span>
<span><span class="co">## $ Amount <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 149.62<span style="color: #949494;">, </span>2.69<span style="color: #949494;">, </span>378.66<span style="color: #949494;">, </span>123.50<span style="color: #949494;">, </span>69.99<span style="color: #949494;">, </span>3.67<span style="color: #949494;">, </span>4.99<span style="color: #949494;">, </span>40.80<span style="color: #949494;">, </span>93.…</span></span>
<span><span class="co">## $ Class  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">,</span>…</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="prepare-a-validation-set">Prepare a validation set<a class="anchor" aria-label="anchor" href="#prepare-a-validation-set"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">val_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op"><a href="../../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span> <span class="va">.</span> <span class="op">*</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">val_df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">val_idx</span>, <span class="op">]</span></span>
<span><span class="va">train_df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="op">-</span><span class="va">val_idx</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of training samples:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">train_df</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Number of training samples: 227846</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of validation samples:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">val_df</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Number of validation samples: 56961</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="analyze-class-imbalance-in-the-targets">Analyze class imbalance in the targets<a class="anchor" aria-label="anchor" href="#analyze-class-imbalance-in-the-targets"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">train_df</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></span>
<span><span class="va">counts</span></span></code></pre></div>
<pre><code><span><span class="co">##</span></span>
<span><span class="co">##      0      1</span></span>
<span><span class="co">## 227448    398</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Number of positive samples in training data: %i (%.2f%% of total)"</span>,</span>
<span>            <span class="va">counts</span><span class="op">[</span><span class="st">"1"</span><span class="op">]</span>, <span class="fl">100</span> <span class="op">*</span> <span class="va">counts</span><span class="op">[</span><span class="st">"1"</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Number of positive samples in training data: 398 (0.17% of total)</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_for_0</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">counts</span><span class="op">[</span><span class="st">"0"</span><span class="op">]</span></span>
<span><span class="va">weight_for_1</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">counts</span><span class="op">[</span><span class="st">"1"</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="normalize-the-data-using-training-set-statistics">Normalize the data using training set statistics<a class="anchor" aria-label="anchor" href="#normalize-the-data-using-training-set-statistics"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feature_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">train_df</span><span class="op">)</span> <span class="op"><a href="../../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="st">"Class"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_df</span><span class="op">[</span><span class="va">feature_names</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">train_targets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">train_df</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></span>
<span></span>
<span><span class="va">val_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">val_df</span><span class="op">[</span><span class="va">feature_names</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">val_targets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">val_df</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train_features</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">val_features</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span>center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">train_features</span>, <span class="st">"scaled:center"</span><span class="op">)</span>,</span>
<span>                        scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">train_features</span>, <span class="st">"scaled:scale"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="build-a-binary-classification-model">Build a binary classification model<a class="anchor" aria-label="anchor" href="#build-a-binary-classification-model"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../../../reference/keras_model_sequential.html">keras_model_sequential</a></span><span class="op">(</span>input_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">train_features</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">256</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">256</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/layer_dropout.html">layer_dropout</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">256</span>, activation <span class="op">=</span> <span class="st">"relu"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/layer_dropout.html">layer_dropout</a></span><span class="op">(</span><span class="fl">0.3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../../../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">1</span>, activation <span class="op">=</span> <span class="st">"sigmoid"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Model: "sequential"</span></span></span>
<span><span class="co">## ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓</span></span>
<span><span class="co">## ┃<span style="font-weight: bold;"> Layer (type)                    </span>┃<span style="font-weight: bold;"> Output Shape           </span>┃<span style="font-weight: bold;">       Param # </span>┃</span></span>
<span><span class="co">## ┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩</span></span>
<span><span class="co">## │ dense (<span style="color: #0087FF;">Dense</span>)                   │ (<span style="color: #00D7FF;">None</span>, <span style="color: #00AF00;">256</span>)            │         <span style="color: #00AF00;">7,936</span> │</span></span>
<span><span class="co">## ├─────────────────────────────────┼────────────────────────┼───────────────┤</span></span>
<span><span class="co">## │ dense_1 (<span style="color: #0087FF;">Dense</span>)                 │ (<span style="color: #00D7FF;">None</span>, <span style="color: #00AF00;">256</span>)            │        <span style="color: #00AF00;">65,792</span> │</span></span>
<span><span class="co">## ├─────────────────────────────────┼────────────────────────┼───────────────┤</span></span>
<span><span class="co">## │ dropout (<span style="color: #0087FF;">Dropout</span>)               │ (<span style="color: #00D7FF;">None</span>, <span style="color: #00AF00;">256</span>)            │             <span style="color: #00AF00;">0</span> │</span></span>
<span><span class="co">## ├─────────────────────────────────┼────────────────────────┼───────────────┤</span></span>
<span><span class="co">## │ dense_2 (<span style="color: #0087FF;">Dense</span>)                 │ (<span style="color: #00D7FF;">None</span>, <span style="color: #00AF00;">256</span>)            │        <span style="color: #00AF00;">65,792</span> │</span></span>
<span><span class="co">## ├─────────────────────────────────┼────────────────────────┼───────────────┤</span></span>
<span><span class="co">## │ dropout_1 (<span style="color: #0087FF;">Dropout</span>)             │ (<span style="color: #00D7FF;">None</span>, <span style="color: #00AF00;">256</span>)            │             <span style="color: #00AF00;">0</span> │</span></span>
<span><span class="co">## ├─────────────────────────────────┼────────────────────────┼───────────────┤</span></span>
<span><span class="co">## │ dense_3 (<span style="color: #0087FF;">Dense</span>)                 │ (<span style="color: #00D7FF;">None</span>, <span style="color: #00AF00;">1</span>)              │           <span style="color: #00AF00;">257</span> │</span></span>
<span><span class="co">## └─────────────────────────────────┴────────────────────────┴───────────────┘</span></span>
<span><span class="co">## <span style="font-weight: bold;"> Total params: </span><span style="color: #00AF00;">139,777</span> (546.00 KB)</span></span>
<span><span class="co">## <span style="font-weight: bold;"> Trainable params: </span><span style="color: #00AF00;">139,777</span> (546.00 KB)</span></span>
<span><span class="co">## <span style="font-weight: bold;"> Non-trainable params: </span><span style="color: #00AF00;">0</span> (0.00 B)</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="train-the-model-with-class_weight-argument">Train the model with <code>class_weight</code> argument<a class="anchor" aria-label="anchor" href="#train-the-model-with-class_weight-argument"></a>
</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../../../reference/metric_false_negatives.html">metric_false_negatives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"fn"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../../reference/metric_false_positives.html">metric_false_positives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"fp"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../../reference/metric_true_negatives.html">metric_true_negatives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"tn"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../../reference/metric_true_positives.html">metric_true_positives</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"tp"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../../reference/metric_precision.html">metric_precision</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"precision"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../../../reference/metric_recall.html">metric_recall</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"recall"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/compile.html" class="external-link">compile</a></span><span class="op">(</span></span>
<span>  optimizer <span class="op">=</span> <span class="fu"><a href="../../../reference/optimizer_adam.html">optimizer_adam</a></span><span class="op">(</span><span class="fl">1e-2</span><span class="op">)</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"binary_crossentropy"</span>,</span>
<span>  metrics <span class="op">=</span> <span class="va">metrics</span></span>
<span><span class="op">)</span></span>
<span><span class="va">callbacks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../../../reference/callback_model_checkpoint.html">callback_model_checkpoint</a></span><span class="op">(</span><span class="st">"fraud_model_at_epoch_{epoch}.keras"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">class_weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"0"</span> <span class="op">=</span> <span class="va">weight_for_0</span>,</span>
<span>                     <span class="st">"1"</span> <span class="op">=</span> <span class="va">weight_for_1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span></span>
<span>  <span class="va">train_features</span>, <span class="va">train_targets</span>,</span>
<span>  validation_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">val_features</span>, <span class="va">val_targets</span><span class="op">)</span>,</span>
<span>  class_weight <span class="op">=</span> <span class="va">class_weight</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fl">2048</span>,</span>
<span>  epochs <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  callbacks <span class="op">=</span> <span class="va">callbacks</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Epoch 1/30</span></span>
<span><span class="co">## 112/112 - 5s - 42ms/step - fn: 47.0000 - fp: 26573.0000 - loss: 2.2940e-06 - precision: 0.0130 - recall: 0.8819 - tn: 200875.0000 - tp: 351.0000 - val_fn: 10.0000 - val_fp: 2548.0000 - val_loss: 0.1712 - val_precision: 0.0319 - val_recall: 0.8936 - val_tn: 54319.0000 - val_tp: 84.0000</span></span>
<span><span class="co">## Epoch 2/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 36.0000 - fp: 13857.0000 - loss: 1.8260e-06 - precision: 0.0255 - recall: 0.9095 - tn: 213591.0000 - tp: 362.0000 - val_fn: 12.0000 - val_fp: 669.0000 - val_loss: 0.0792 - val_precision: 0.1092 - val_recall: 0.8723 - val_tn: 56198.0000 - val_tp: 82.0000</span></span>
<span><span class="co">## Epoch 3/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 25.0000 - fp: 5433.0000 - loss: 1.1157e-06 - precision: 0.0642 - recall: 0.9372 - tn: 222015.0000 - tp: 373.0000 - val_fn: 10.0000 - val_fp: 2759.0000 - val_loss: 0.1609 - val_precision: 0.0295 - val_recall: 0.8936 - val_tn: 54108.0000 - val_tp: 84.0000</span></span>
<span><span class="co">## Epoch 4/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 20.0000 - fp: 7841.0000 - loss: 1.1623e-06 - precision: 0.0460 - recall: 0.9497 - tn: 219607.0000 - tp: 378.0000 - val_fn: 11.0000 - val_fp: 946.0000 - val_loss: 0.0651 - val_precision: 0.0807 - val_recall: 0.8830 - val_tn: 55921.0000 - val_tp: 83.0000</span></span>
<span><span class="co">## Epoch 5/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 19.0000 - fp: 4984.0000 - loss: 8.3970e-07 - precision: 0.0707 - recall: 0.9523 - tn: 222464.0000 - tp: 379.0000 - val_fn: 8.0000 - val_fp: 6227.0000 - val_loss: 0.3212 - val_precision: 0.0136 - val_recall: 0.9149 - val_tn: 50640.0000 - val_tp: 86.0000</span></span>
<span><span class="co">## Epoch 6/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 14.0000 - fp: 7881.0000 - loss: 8.6507e-07 - precision: 0.0465 - recall: 0.9648 - tn: 219567.0000 - tp: 384.0000 - val_fn: 11.0000 - val_fp: 1153.0000 - val_loss: 0.0576 - val_precision: 0.0672 - val_recall: 0.8830 - val_tn: 55714.0000 - val_tp: 83.0000</span></span>
<span><span class="co">## Epoch 7/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 14.0000 - fp: 5960.0000 - loss: 6.3656e-07 - precision: 0.0605 - recall: 0.9648 - tn: 221488.0000 - tp: 384.0000 - val_fn: 9.0000 - val_fp: 1756.0000 - val_loss: 0.0919 - val_precision: 0.0462 - val_recall: 0.9043 - val_tn: 55111.0000 - val_tp: 85.0000</span></span>
<span><span class="co">## Epoch 8/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 13.0000 - fp: 7336.0000 - loss: 7.0340e-07 - precision: 0.0499 - recall: 0.9673 - tn: 220112.0000 - tp: 385.0000 - val_fn: 12.0000 - val_fp: 1123.0000 - val_loss: 0.0648 - val_precision: 0.0680 - val_recall: 0.8723 - val_tn: 55744.0000 - val_tp: 82.0000</span></span>
<span><span class="co">## Epoch 9/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 8.0000 - fp: 5826.0000 - loss: 5.7082e-07 - precision: 0.0627 - recall: 0.9799 - tn: 221622.0000 - tp: 390.0000 - val_fn: 10.0000 - val_fp: 1297.0000 - val_loss: 0.0582 - val_precision: 0.0608 - val_recall: 0.8936 - val_tn: 55570.0000 - val_tp: 84.0000</span></span>
<span><span class="co">## Epoch 10/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 6.0000 - fp: 5673.0000 - loss: 5.4126e-07 - precision: 0.0646 - recall: 0.9849 - tn: 221775.0000 - tp: 392.0000 - val_fn: 10.0000 - val_fp: 1635.0000 - val_loss: 0.0671 - val_precision: 0.0489 - val_recall: 0.8936 - val_tn: 55232.0000 - val_tp: 84.0000</span></span>
<span><span class="co">## Epoch 11/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 7.0000 - fp: 5375.0000 - loss: 6.0988e-07 - precision: 0.0678 - recall: 0.9824 - tn: 222073.0000 - tp: 391.0000 - val_fn: 13.0000 - val_fp: 1406.0000 - val_loss: 0.0892 - val_precision: 0.0545 - val_recall: 0.8617 - val_tn: 55461.0000 - val_tp: 81.0000</span></span>
<span><span class="co">## Epoch 12/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 9.0000 - fp: 7441.0000 - loss: 6.7316e-07 - precision: 0.0497 - recall: 0.9774 - tn: 220007.0000 - tp: 389.0000 - val_fn: 13.0000 - val_fp: 669.0000 - val_loss: 0.0435 - val_precision: 0.1080 - val_recall: 0.8617 - val_tn: 56198.0000 - val_tp: 81.0000</span></span>
<span><span class="co">## Epoch 13/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 4.0000 - fp: 3489.0000 - loss: 3.3523e-07 - precision: 0.1015 - recall: 0.9899 - tn: 223959.0000 - tp: 394.0000 - val_fn: 13.0000 - val_fp: 617.0000 - val_loss: 0.0337 - val_precision: 0.1160 - val_recall: 0.8617 - val_tn: 56250.0000 - val_tp: 81.0000</span></span>
<span><span class="co">## Epoch 14/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 10.0000 - fp: 5190.0000 - loss: 4.8929e-07 - precision: 0.0696 - recall: 0.9749 - tn: 222258.0000 - tp: 388.0000 - val_fn: 9.0000 - val_fp: 2192.0000 - val_loss: 0.1018 - val_precision: 0.0373 - val_recall: 0.9043 - val_tn: 54675.0000 - val_tp: 85.0000</span></span>
<span><span class="co">## Epoch 15/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 6.0000 - fp: 5348.0000 - loss: 4.3230e-07 - precision: 0.0683 - recall: 0.9849 - tn: 222100.0000 - tp: 392.0000 - val_fn: 11.0000 - val_fp: 3056.0000 - val_loss: 0.1279 - val_precision: 0.0264 - val_recall: 0.8830 - val_tn: 53811.0000 - val_tp: 83.0000</span></span>
<span><span class="co">## Epoch 16/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 5.0000 - fp: 4834.0000 - loss: 3.7224e-07 - precision: 0.0752 - recall: 0.9874 - tn: 222614.0000 - tp: 393.0000 - val_fn: 12.0000 - val_fp: 617.0000 - val_loss: 0.0322 - val_precision: 0.1173 - val_recall: 0.8723 - val_tn: 56250.0000 - val_tp: 82.0000</span></span>
<span><span class="co">## Epoch 17/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 6.0000 - fp: 5150.0000 - loss: 4.2131e-07 - precision: 0.0707 - recall: 0.9849 - tn: 222298.0000 - tp: 392.0000 - val_fn: 13.0000 - val_fp: 620.0000 - val_loss: 0.0363 - val_precision: 0.1155 - val_recall: 0.8617 - val_tn: 56247.0000 - val_tp: 81.0000</span></span>
<span><span class="co">## Epoch 18/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 5.0000 - fp: 3020.0000 - loss: 3.0311e-07 - precision: 0.1151 - recall: 0.9874 - tn: 224428.0000 - tp: 393.0000 - val_fn: 11.0000 - val_fp: 593.0000 - val_loss: 0.0332 - val_precision: 0.1228 - val_recall: 0.8830 - val_tn: 56274.0000 - val_tp: 83.0000</span></span>
<span><span class="co">## Epoch 19/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 2.0000 - fp: 3154.0000 - loss: 2.5504e-07 - precision: 0.1115 - recall: 0.9950 - tn: 224294.0000 - tp: 396.0000 - val_fn: 12.0000 - val_fp: 863.0000 - val_loss: 0.0457 - val_precision: 0.0868 - val_recall: 0.8723 - val_tn: 56004.0000 - val_tp: 82.0000</span></span>
<span><span class="co">## Epoch 20/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 4.0000 - fp: 5315.0000 - loss: 4.6083e-07 - precision: 0.0690 - recall: 0.9899 - tn: 222133.0000 - tp: 394.0000 - val_fn: 11.0000 - val_fp: 867.0000 - val_loss: 0.0490 - val_precision: 0.0874 - val_recall: 0.8830 - val_tn: 56000.0000 - val_tp: 83.0000</span></span>
<span><span class="co">## Epoch 21/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 4.0000 - fp: 4040.0000 - loss: 4.3505e-07 - precision: 0.0889 - recall: 0.9899 - tn: 223408.0000 - tp: 394.0000 - val_fn: 11.0000 - val_fp: 1104.0000 - val_loss: 0.0490 - val_precision: 0.0699 - val_recall: 0.8830 - val_tn: 55763.0000 - val_tp: 83.0000</span></span>
<span><span class="co">## Epoch 22/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 6.0000 - fp: 6280.0000 - loss: 5.3667e-07 - precision: 0.0588 - recall: 0.9849 - tn: 221168.0000 - tp: 392.0000 - val_fn: 11.0000 - val_fp: 573.0000 - val_loss: 0.0306 - val_precision: 0.1265 - val_recall: 0.8830 - val_tn: 56294.0000 - val_tp: 83.0000</span></span>
<span><span class="co">## Epoch 23/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 4.0000 - fp: 3863.0000 - loss: 3.9085e-07 - precision: 0.0926 - recall: 0.9899 - tn: 223585.0000 - tp: 394.0000 - val_fn: 10.0000 - val_fp: 1141.0000 - val_loss: 0.0498 - val_precision: 0.0686 - val_recall: 0.8936 - val_tn: 55726.0000 - val_tp: 84.0000</span></span>
<span><span class="co">## Epoch 24/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 6.0000 - fp: 4593.0000 - loss: 4.3019e-07 - precision: 0.0786 - recall: 0.9849 - tn: 222855.0000 - tp: 392.0000 - val_fn: 9.0000 - val_fp: 1706.0000 - val_loss: 0.0643 - val_precision: 0.0475 - val_recall: 0.9043 - val_tn: 55161.0000 - val_tp: 85.0000</span></span>
<span><span class="co">## Epoch 25/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 3.0000 - fp: 4266.0000 - loss: 3.2117e-07 - precision: 0.0847 - recall: 0.9925 - tn: 223182.0000 - tp: 395.0000 - val_fn: 10.0000 - val_fp: 1651.0000 - val_loss: 0.0764 - val_precision: 0.0484 - val_recall: 0.8936 - val_tn: 55216.0000 - val_tp: 84.0000</span></span>
<span><span class="co">## Epoch 26/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 2.0000 - fp: 3221.0000 - loss: 2.9923e-07 - precision: 0.1095 - recall: 0.9950 - tn: 224227.0000 - tp: 396.0000 - val_fn: 9.0000 - val_fp: 1494.0000 - val_loss: 0.0977 - val_precision: 0.0538 - val_recall: 0.9043 - val_tn: 55373.0000 - val_tp: 85.0000</span></span>
<span><span class="co">## Epoch 27/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 0.0000e+00 - fp: 3195.0000 - loss: 2.6797e-07 - precision: 0.1108 - recall: 1.0000 - tn: 224253.0000 - tp: 398.0000 - val_fn: 12.0000 - val_fp: 470.0000 - val_loss: 0.0303 - val_precision: 0.1486 - val_recall: 0.8723 - val_tn: 56397.0000 - val_tp: 82.0000</span></span>
<span><span class="co">## Epoch 28/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 3.0000 - fp: 2700.0000 - loss: 2.6402e-07 - precision: 0.1276 - recall: 0.9925 - tn: 224748.0000 - tp: 395.0000 - val_fn: 13.0000 - val_fp: 711.0000 - val_loss: 0.0381 - val_precision: 0.1023 - val_recall: 0.8617 - val_tn: 56156.0000 - val_tp: 81.0000</span></span>
<span><span class="co">## Epoch 29/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 1.0000 - fp: 1625.0000 - loss: 1.7383e-07 - precision: 0.1963 - recall: 0.9975 - tn: 225823.0000 - tp: 397.0000 - val_fn: 13.0000 - val_fp: 543.0000 - val_loss: 0.0313 - val_precision: 0.1298 - val_recall: 0.8617 - val_tn: 56324.0000 - val_tp: 81.0000</span></span>
<span><span class="co">## Epoch 30/30</span></span>
<span><span class="co">## 112/112 - 0s - 2ms/step - fn: 0.0000e+00 - fp: 1564.0000 - loss: 1.3238e-07 - precision: 0.2029 - recall: 1.0000 - tn: 225884.0000 - tp: 398.0000 - val_fn: 13.0000 - val_fp: 309.0000 - val_loss: 0.0218 - val_precision: 0.2077 - val_recall: 0.8617 - val_tn: 56558.0000 - val_tp: 81.0000</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">val_pred</span> <span class="op">&lt;-</span> <span class="va">model</span> <span class="op"><a href="../../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">val_features</span><span class="op">)</span> <span class="op"><a href="../../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">.</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## 1781/1781 - 1s - 556us/step</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_correct</span> <span class="op">&lt;-</span> <span class="va">val_df</span><span class="op">$</span><span class="va">Class</span> <span class="op">==</span> <span class="va">val_pred</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Validation accuracy: %.2f"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pred_correct</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Validation accuracy: 0.99</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fraudulent</span> <span class="op">&lt;-</span> <span class="va">val_df</span><span class="op">$</span><span class="va">Class</span> <span class="op">==</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">n_fraudulent_detected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fraudulent</span> <span class="op">&amp;</span> <span class="va">pred_correct</span><span class="op">)</span></span>
<span><span class="va">n_fraudulent_missed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fraudulent</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">pred_correct</span><span class="op">)</span></span>
<span><span class="va">n_legitimate_flagged</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">fraudulent</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">pred_correct</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>At the end of training, out of 56,961 validation transactions, we
are:</p>
<ul>
<li>Correctly identifying 81 of them as fraudulent</li>
<li>Missing 13 fraudulent transactions</li>
<li>At the cost of incorrectly flagging 309 legitimate transactions</li>
</ul>
<p>In the real world, one would put an even higher weight on class 1, so
as to reflect that False Negatives are more costly than False
Positives.</p>
<p>Next time your credit card gets declined in an online purchase – this
is why.</p>
<!-- | Trained Model                                                                                                                                                          | Demo                                                                                                                                                                             | -->
<!-- |------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| -->
<!-- | [![Generic badge](https://img.shields.io/badge/%F0%9F%A4%97%20Model-Imbalanced%20Classification-black.svg)](https://huggingface.co/keras-io/imbalanced_classification) | [![Generic badge](https://img.shields.io/badge/%F0%9F%A4%97%20Spaces-Imbalanced%20Classification-black.svg)](https://huggingface.co/spaces/keras-io/Credit_Card_Fraud_Detection) | -->
<!-- : Example available on HuggingFace. -->
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tomasz Kalinowski, JJ Allaire, François Chollet, Posit Software, PBC, Google.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>

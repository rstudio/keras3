<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Resize images to a target size without aspect ratio distortion. — image_smart_resize • keras3</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Resize images to a target size without aspect ratio distortion. — image_smart_resize"><meta name="description" content="Image datasets typically yield images that have each a different
size. However, these images need to be batched before they can be
processed by Keras layers. To be batched, images need to share the same
height and width.
You could simply do, in TF (or JAX equivalent):
size &amp;lt;- c(200, 200)
ds &amp;lt;- ds$map(\(img) tf$image$resize(img, size))

However, if you do this, you distort the aspect ratio of your images, since
in general they do not all have the same aspect ratio as size. This is
fine in many cases, but not always (e.g. for image generation models
this can be a problem).
Note that passing the argument preserve_aspect_ratio = TRUE to tf$image$resize()
will preserve the aspect ratio, but at the cost of no longer respecting the
provided target size.
This calls for:
size &amp;lt;- c(200, 200)
ds &amp;lt;- ds$map(\(img) image_smart_resize(img, size))

Your output images will actually be (200, 200), and will not be distorted.
Instead, the parts of the image that do not fit within the target size
get cropped out.
The resizing process is:
Take the largest centered crop of the image that has the same aspect
ratio as the target size. For instance, if size = c(200, 200) and the input
image has size (340, 500), we take a crop of (340, 340) centered along
the width.
Resize the cropped image to the target size. In the example above,
we resize the (340, 340) crop to (200, 200).

"><meta property="og:description" content="Image datasets typically yield images that have each a different
size. However, these images need to be batched before they can be
processed by Keras layers. To be batched, images need to share the same
height and width.
You could simply do, in TF (or JAX equivalent):
size &amp;lt;- c(200, 200)
ds &amp;lt;- ds$map(\(img) tf$image$resize(img, size))

However, if you do this, you distort the aspect ratio of your images, since
in general they do not all have the same aspect ratio as size. This is
fine in many cases, but not always (e.g. for image generation models
this can be a problem).
Note that passing the argument preserve_aspect_ratio = TRUE to tf$image$resize()
will preserve the aspect ratio, but at the cost of no longer respecting the
provided target size.
This calls for:
size &amp;lt;- c(200, 200)
ds &amp;lt;- ds$map(\(img) image_smart_resize(img, size))

Your output images will actually be (200, 200), and will not be distorted.
Instead, the parts of the image that do not fit within the target size
get cropped out.
The resizing process is:
Take the largest centered crop of the image that has the same aspect
ratio as the target size. For instance, if size = c(200, 200) and the input
image has size (340, 500), we take a crop of (340, 340) centered along
the width.
Resize the cropped image to the target size. In the example above,
we resize the (340, 340) crop to (200, 200).

"><meta name="robots" content="noindex"><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KHBDBW7');</script><!-- End Google Tag Manager --></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KHBDBW7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) -->


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="inverse" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">keras3</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/getting_started.html">Getting Started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-guides"><li><h6 class="dropdown-header" data-toc-skip>Model definition</h6></li>
    <li><a class="dropdown-item" href="../articles/sequential_model.html">Sequential Model</a></li>
    <li><a class="dropdown-item" href="../articles/functional_api.html">Functional API</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending and customizing</h6></li>
    <li><a class="dropdown-item" href="../articles/training_with_built_in_methods.html">Training &amp; evaluation with the built-in methods</a></li>
    <li><a class="dropdown-item" href="../articles/custom_train_step_in_tensorflow.html">Customizing `fit()` with Tensorflow</a></li>
    <li><a class="dropdown-item" href="../articles/writing_your_own_callbacks.html">Writing your own callbacks</a></li>
    <li><a class="dropdown-item" href="../articles/making_new_layers_and_models_via_subclassing.html">Making new layers and models via subclassing</a></li>
    <li><a class="dropdown-item" href="../articles/writing_a_custom_training_loop_in_tensorflow.html">Writing a training loop from scratch in TensorFlow</a></li>
    <li><a class="dropdown-item" href="../articles/serialization_and_saving.html">Serialization and Saving</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other topics</h6></li>
    <li><a class="dropdown-item" href="../articles/transfer_learning.html">Transfer learning and fine tuning</a></li>
    <li><a class="dropdown-item" href="../articles/distributed_training_with_tensorflow.html">Distributed training with TensorFlow</a></li>
    <li><a class="dropdown-item" href="../articles/distribution.html">Distributed training with Jax</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../articles/examples/index.html">Examples</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/keras3/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Resize images to a target size without aspect ratio distortion.</h1>
      <small class="dont-index">Source: <a href="https://github.com/rstudio/keras3/blob/HEAD/R/preprocessing-image.R" class="external-link"><code>R/preprocessing-image.R</code></a></small>
      <div class="d-none name"><code>image_smart_resize.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Image datasets typically yield images that have each a different
size. However, these images need to be batched before they can be
processed by Keras layers. To be batched, images need to share the same
height and width.</p>
<p>You could simply do, in TF (or JAX equivalent):</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="va">ds</span><span class="op">$</span><span class="fu">map</span><span class="op">(</span>\<span class="op">(</span><span class="va">img</span><span class="op">)</span> <span class="va">tf</span><span class="op">$</span><span class="va">image</span><span class="op">$</span><span class="fu">resize</span><span class="op">(</span><span class="va">img</span>, <span class="va">size</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p>However, if you do this, you distort the aspect ratio of your images, since
in general they do not all have the same aspect ratio as <code>size</code>. This is
fine in many cases, but not always (e.g. for image generation models
this can be a problem).</p>
<p>Note that passing the argument <code>preserve_aspect_ratio = TRUE</code> to <code>tf$image$resize()</code>
will preserve the aspect ratio, but at the cost of no longer respecting the
provided target size.</p>
<p>This calls for:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="va">ds</span><span class="op">$</span><span class="fu">map</span><span class="op">(</span>\<span class="op">(</span><span class="va">img</span><span class="op">)</span> <span class="fu"><a href="../reference/image_smart_resize.html">image_smart_resize</a></span><span class="op">(</span><span class="va">img</span>, <span class="va">size</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Your output images will actually be <code>(200, 200)</code>, and will not be distorted.
Instead, the parts of the image that do not fit within the target size
get cropped out.</p>
<p>The resizing process is:</p><ol><li><p>Take the largest centered crop of the image that has the same aspect
ratio as the target size. For instance, if <code>size = c(200, 200)</code> and the input
image has size <code>(340, 500)</code>, we take a crop of <code>(340, 340)</code> centered along
the width.</p></li>
<li><p>Resize the cropped image to the target size. In the example above,
we resize the <code>(340, 340)</code> crop to <code>(200, 200)</code>.</p></li>
</ol></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">image_smart_resize</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">size</span>,</span>
<span>  interpolation <span class="op">=</span> <span class="st">"bilinear"</span>,</span>
<span>  data_format <span class="op">=</span> <span class="st">"channels_last"</span>,</span>
<span>  backend_module <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Input image or batch of images (as a tensor or array).
Must be in format <code>(height, width, channels)</code>
or <code>(batch_size, height, width, channels)</code>.</p></dd>


<dt id="arg-size">size<a class="anchor" aria-label="anchor" href="#arg-size"></a></dt>
<dd><p>Tuple of <code>(height, width)</code> integer. Target size.</p></dd>


<dt id="arg-interpolation">interpolation<a class="anchor" aria-label="anchor" href="#arg-interpolation"></a></dt>
<dd><p>String, interpolation to use for resizing.
Supports <code>"bilinear"</code>, <code>"nearest"</code>, <code>"bicubic"</code>,
<code>"lanczos3"</code>, <code>"lanczos5"</code>.
Defaults to <code>'bilinear'</code>.</p></dd>


<dt id="arg-data-format">data_format<a class="anchor" aria-label="anchor" href="#arg-data-format"></a></dt>
<dd><p><code>"channels_last"</code> or <code>"channels_first"</code>.</p></dd>


<dt id="arg-backend-module">backend_module<a class="anchor" aria-label="anchor" href="#arg-backend-module"></a></dt>
<dd><p>Backend module to use (if different from the default
backend).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Array with shape <code>(size[1], size[2], channels)</code>.
If the input image was an array, the output is an array,
and if it was a backend-native tensor,
the output is a backend-native tensor.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other image utils: <br><code><a href="image_array_save.html">image_array_save</a>()</code> <br><code><a href="image_from_array.html">image_from_array</a>()</code> <br><code><a href="image_load.html">image_load</a>()</code> <br><code><a href="image_to_array.html">image_to_array</a>()</code> <br><code><a href="op_image_affine_transform.html">op_image_affine_transform</a>()</code> <br><code><a href="op_image_crop.html">op_image_crop</a>()</code> <br><code><a href="op_image_extract_patches.html">op_image_extract_patches</a>()</code> <br><code><a href="op_image_gaussian_blur.html">op_image_gaussian_blur</a>()</code> <br><code><a href="op_image_hsv_to_rgb.html">op_image_hsv_to_rgb</a>()</code> <br><code><a href="op_image_map_coordinates.html">op_image_map_coordinates</a>()</code> <br><code><a href="op_image_pad.html">op_image_pad</a>()</code> <br><code><a href="op_image_perspective_transform.html">op_image_perspective_transform</a>()</code> <br><code><a href="op_image_resize.html">op_image_resize</a>()</code> <br><code><a href="op_image_rgb_to_grayscale.html">op_image_rgb_to_grayscale</a>()</code> <br><code><a href="op_image_rgb_to_hsv.html">op_image_rgb_to_hsv</a>()</code> <br></p>
<p>Other utils: <br><code><a href="audio_dataset_from_directory.html">audio_dataset_from_directory</a>()</code> <br><code><a href="clear_session.html">clear_session</a>()</code> <br><code><a href="config_disable_interactive_logging.html">config_disable_interactive_logging</a>()</code> <br><code><a href="config_disable_traceback_filtering.html">config_disable_traceback_filtering</a>()</code> <br><code><a href="config_enable_interactive_logging.html">config_enable_interactive_logging</a>()</code> <br><code><a href="config_enable_traceback_filtering.html">config_enable_traceback_filtering</a>()</code> <br><code><a href="config_is_interactive_logging_enabled.html">config_is_interactive_logging_enabled</a>()</code> <br><code><a href="config_is_traceback_filtering_enabled.html">config_is_traceback_filtering_enabled</a>()</code> <br><code><a href="get_file.html">get_file</a>()</code> <br><code><a href="get_source_inputs.html">get_source_inputs</a>()</code> <br><code><a href="image_array_save.html">image_array_save</a>()</code> <br><code><a href="image_dataset_from_directory.html">image_dataset_from_directory</a>()</code> <br><code><a href="image_from_array.html">image_from_array</a>()</code> <br><code><a href="image_load.html">image_load</a>()</code> <br><code><a href="image_to_array.html">image_to_array</a>()</code> <br><code><a href="layer_feature_space.html">layer_feature_space</a>()</code> <br><code><a href="normalize.html">normalize</a>()</code> <br><code><a href="pad_sequences.html">pad_sequences</a>()</code> <br><code><a href="set_random_seed.html">set_random_seed</a>()</code> <br><code><a href="split_dataset.html">split_dataset</a>()</code> <br><code><a href="text_dataset_from_directory.html">text_dataset_from_directory</a>()</code> <br><code><a href="timeseries_dataset_from_array.html">timeseries_dataset_from_array</a>()</code> <br><code><a href="to_categorical.html">to_categorical</a>()</code> <br><code><a href="zip_lists.html">zip_lists</a>()</code> <br></p>
<p>Other preprocessing: <br><code><a href="image_dataset_from_directory.html">image_dataset_from_directory</a>()</code> <br><code><a href="text_dataset_from_directory.html">text_dataset_from_directory</a>()</code> <br><code><a href="timeseries_dataset_from_array.html">timeseries_dataset_from_array</a>()</code> <br></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tomasz Kalinowski, JJ Allaire, François Chollet, Posit Software, PBC, Google.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Keras Layer that wraps a JAX model. — layer_jax_model_wrapper • keras3</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Keras Layer that wraps a JAX model. — layer_jax_model_wrapper"><meta name="description" content="This layer enables the use of JAX components within Keras when using JAX as
the backend for Keras."><meta property="og:description" content="This layer enables the use of JAX components within Keras when using JAX as
the backend for Keras."><meta name="robots" content="noindex"><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KHBDBW7');</script><!-- End Google Tag Manager --></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KHBDBW7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) -->


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="inverse" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">keras3</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/getting_started.html">Getting Started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-guides"><li><h6 class="dropdown-header" data-toc-skip>Model definition</h6></li>
    <li><a class="dropdown-item" href="../articles/sequential_model.html">Sequential Model</a></li>
    <li><a class="dropdown-item" href="../articles/functional_api.html">Functional API</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending and customizing</h6></li>
    <li><a class="dropdown-item" href="../articles/training_with_built_in_methods.html">Training &amp; evaluation with the built-in methods</a></li>
    <li><a class="dropdown-item" href="../articles/custom_train_step_in_tensorflow.html">Customizing `fit()` with Tensorflow</a></li>
    <li><a class="dropdown-item" href="../articles/writing_your_own_callbacks.html">Writing your own callbacks</a></li>
    <li><a class="dropdown-item" href="../articles/making_new_layers_and_models_via_subclassing.html">Making new layers and models via subclassing</a></li>
    <li><a class="dropdown-item" href="../articles/writing_a_custom_training_loop_in_tensorflow.html">Writing a training loop from scratch in TensorFlow</a></li>
    <li><a class="dropdown-item" href="../articles/serialization_and_saving.html">Serialization and Saving</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other topics</h6></li>
    <li><a class="dropdown-item" href="../articles/transfer_learning.html">Transfer learning and fine tuning</a></li>
    <li><a class="dropdown-item" href="../articles/distributed_training_with_tensorflow.html">Distributed training with TensorFlow</a></li>
    <li><a class="dropdown-item" href="../articles/distribution.html">Distributed training with Jax</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../articles/examples/index.html">Examples</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/keras3/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Keras Layer that wraps a JAX model.</h1>
      <small class="dont-index">Source: <a href="https://github.com/rstudio/keras3/blob/HEAD/R/layers-backend-wrappers.R" class="external-link"><code>R/layers-backend-wrappers.R</code></a></small>
      <div class="d-none name"><code>layer_jax_model_wrapper.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This layer enables the use of JAX components within Keras when using JAX as
the backend for Keras.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">layer_jax_model_wrapper</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">call_fn</span>,</span>
<span>  init_fn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  params <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  state <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  dtype <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>Object to compose the layer with. A tensor, array, or sequential model.</p></dd>


<dt id="arg-call-fn">call_fn<a class="anchor" aria-label="anchor" href="#arg-call-fn"></a></dt>
<dd><p>The function to call the model. See description above for the
list of arguments it takes and the outputs it returns.</p></dd>


<dt id="arg-init-fn">init_fn<a class="anchor" aria-label="anchor" href="#arg-init-fn"></a></dt>
<dd><p>the function to call to initialize the model. See description
above for the list of arguments it takes and the outputs it returns.
If <code>NULL</code>, then <code>params</code> and/or <code>state</code> must be provided.</p></dd>


<dt id="arg-params">params<a class="anchor" aria-label="anchor" href="#arg-params"></a></dt>
<dd><p>A <code>PyTree</code> containing all the model trainable parameters. This
allows passing trained parameters or controlling the initialization.
If both <code>params</code> and <code>state</code> are <code>NULL</code>, <code>init_fn()</code> is called at
build time to initialize the trainable parameters of the model.</p></dd>


<dt id="arg-state">state<a class="anchor" aria-label="anchor" href="#arg-state"></a></dt>
<dd><p>A <code>PyTree</code> containing all the model non-trainable state. This
allows passing learned state or controlling the initialization. If
both <code>params</code> and <code>state</code> are <code>NULL</code>, and <code>call_fn()</code> takes a <code>state</code>
argument, then <code>init_fn()</code> is called at build time to initialize the
non-trainable state of the model.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Seed for random number generator. Optional.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>For forward/backward compatability.</p></dd>


<dt id="arg-dtype">dtype<a class="anchor" aria-label="anchor" href="#arg-dtype"></a></dt>
<dd><p>The dtype of the layer's computations and weights. Can also be a
<code>keras.DTypePolicy</code>. Optional. Defaults to the default policy.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The return value depends on the value provided for the first argument.
If  <code>object</code> is:</p><ul><li><p>a <code><a href="keras_model_sequential.html">keras_model_sequential()</a></code>, then the layer is added to the sequential model
(which is modified in place). To enable piping, the sequential model is also
returned, invisibly.</p></li>
<li><p>a <code><a href="keras_input.html">keras_input()</a></code>, then the output tensor from calling <code>layer(input)</code> is returned.</p></li>
<li><p><code>NULL</code> or missing, then a <code>Layer</code> instance is returned.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="model-function">Model function<a class="anchor" aria-label="anchor" href="#model-function"></a></h2>
    <p>This layer accepts JAX models in the form of a function, <code>call_fn()</code>, which
must take the following arguments with these exact names:</p><ul><li><p><code>params</code>: trainable parameters of the model.</p></li>
<li><p><code>state</code> (<em>optional</em>): non-trainable state of the model. Can be omitted if
the model has no non-trainable state.</p></li>
<li><p><code>rng</code> (<em>optional</em>): a <code>jax.random.PRNGKey</code> instance. Can be omitted if the
model does not need RNGs, neither during training nor during inference.</p></li>
<li><p><code>inputs</code>: inputs to the model, a JAX array or a <code>PyTree</code> of arrays.</p></li>
<li><p><code>training</code> (<em>optional</em>): an argument specifying if we're in training mode
or inference mode, <code>TRUE</code> is passed in training mode. Can be omitted if
the model behaves the same in training mode and inference mode.</p></li>
</ul><p>The <code>inputs</code> argument is mandatory. Inputs to the model must be provided via
a single argument. If the JAX model takes multiple inputs as separate
arguments, they must be combined into a single structure, for instance in a
<code><a href="https://rstudio.github.io/reticulate/reference/tuple.html" class="external-link">tuple()</a></code> or a <code><a href="https://rstudio.github.io/reticulate/reference/dict.html" class="external-link">dict()</a></code>.</p><div class="section">
<h3 id="model-weights-initialization">Model weights initialization<a class="anchor" aria-label="anchor" href="#model-weights-initialization"></a></h3>


<p>The initialization of the <code>params</code> and <code>state</code> of the model can be handled
by this layer, in which case the <code>init_fn()</code> argument must be provided. This
allows the model to be initialized dynamically with the right shape.
Alternatively, and if the shape is known, the <code>params</code> argument and
optionally the <code>state</code> argument can be used to create an already initialized
model.</p>
<p>The <code>init_fn()</code> function, if provided, must take the following arguments with
these exact names:</p><ul><li><p><code>rng</code>: a <code>jax.random.PRNGKey</code> instance.</p></li>
<li><p><code>inputs</code>: a JAX array or a <code>PyTree</code> of arrays with placeholder values to
provide the shape of the inputs.</p></li>
<li><p><code>training</code> (<em>optional</em>): an argument specifying if we're in training mode
or inference mode. <code>True</code> is always passed to <code>init_fn</code>. Can be omitted
regardless of whether <code>call_fn</code> has a <code>training</code> argument.</p></li>
</ul></div>

<div class="section">
<h3 id="models-with-non-trainable-state">Models with non-trainable state<a class="anchor" aria-label="anchor" href="#models-with-non-trainable-state"></a></h3>


<p>For JAX models that have non-trainable state:</p><ul><li><p><code>call_fn()</code> must have a <code>state</code> argument</p></li>
<li><p><code>call_fn()</code> must return a <code><a href="https://rstudio.github.io/reticulate/reference/tuple.html" class="external-link">tuple()</a></code> containing the outputs of the model and
the new non-trainable state of the model</p></li>
<li><p><code>init_fn()</code> must return a <code><a href="https://rstudio.github.io/reticulate/reference/tuple.html" class="external-link">tuple()</a></code> containing the initial trainable params of
the model and the initial non-trainable state of the model.</p></li>
</ul><p>This code shows a possible combination of <code>call_fn()</code> and <code>init_fn()</code> signatures
for a model with non-trainable state. In this example, the model has a
<code>training</code> argument and an <code>rng</code> argument in <code>call_fn()</code>.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">stateful_call</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">state</span>, <span class="va">rng</span>, <span class="va">inputs</span>, <span class="va">training</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">outputs</span> <span class="op">&lt;-</span> <span class="va">....</span></span>
<span>  <span class="va">new_state</span> <span class="op">&lt;-</span> <span class="va">....</span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/tuple.html" class="external-link">tuple</a></span><span class="op">(</span><span class="va">outputs</span>, <span class="va">new_state</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">stateful_init</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rng</span>, <span class="va">inputs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">initial_params</span> <span class="op">&lt;-</span> <span class="va">....</span></span>
<span>  <span class="va">initial_state</span> <span class="op">&lt;-</span> <span class="va">....</span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/tuple.html" class="external-link">tuple</a></span><span class="op">(</span><span class="va">initial_params</span>, <span class="va">initial_state</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="models-without-non-trainable-state">Models without non-trainable state<a class="anchor" aria-label="anchor" href="#models-without-non-trainable-state"></a></h3>


<p>For JAX models with no non-trainable state:</p><ul><li><p><code>call_fn()</code> must not have a <code>state</code> argument</p></li>
<li><p><code>call_fn()</code> must return only the outputs of the model</p></li>
<li><p><code>init_fn()</code> must return only the initial trainable params of the model.</p></li>
</ul><p>This code shows a possible combination of <code>call_fn()</code> and <code>init_fn()</code> signatures
for a model without non-trainable state. In this example, the model does not
have a <code>training</code> argument and does not have an <code>rng</code> argument in <code>call_fn()</code>.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">stateful_call</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pparams</span>, <span class="va">inputs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">outputs</span> <span class="op">&lt;-</span> <span class="va">....</span></span>
<span>  <span class="va">outputs</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">stateful_init</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rng</span>, <span class="va">inputs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">initial_params</span> <span class="op">&lt;-</span> <span class="va">....</span></span>
<span>  <span class="va">initial_params</span></span>
<span><span class="op">}</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="conforming-to-the-required-signature">Conforming to the required signature<a class="anchor" aria-label="anchor" href="#conforming-to-the-required-signature"></a></h3>


<p>If a model has a different signature than the one required by <code>JaxLayer</code>,
one can easily write a wrapper method to adapt the arguments. This example
shows a model that has multiple inputs as separate arguments, expects
multiple RNGs in a <code>dict</code>, and has a <code>deterministic</code> argument with the
opposite meaning of <code>training</code>. To conform, the inputs are combined in a
single structure using a <code>tuple</code>, the RNG is split and used the populate the
expected <code>dict</code>, and the Boolean flag is negated:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">jax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"jax"</span><span class="op">)</span></span>
<span><span class="va">my_model_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">rngs</span>, <span class="va">input1</span>, <span class="va">input2</span>, <span class="va">deterministic</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">....</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">deterministic</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dropout_rng</span> <span class="op">&lt;-</span> <span class="va">rngs</span><span class="op">$</span><span class="va">dropout</span></span>
<span>    <span class="va">keep</span> <span class="op">&lt;-</span> <span class="va">jax</span><span class="op">$</span><span class="va">random</span><span class="op">$</span><span class="fu">bernoulli</span><span class="op">(</span><span class="va">dropout_rng</span>, <span class="va">dropout_rate</span>, <span class="va">x</span><span class="op">$</span><span class="va">shape</span><span class="op">)</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">jax</span><span class="op">$</span><span class="va">numpy</span><span class="op">$</span><span class="fu">where</span><span class="op">(</span><span class="va">keep</span>, <span class="va">x</span> <span class="op">/</span> <span class="va">dropout_rate</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">....</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">....</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">outputs</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">my_model_wrapper_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">rng</span>, <span class="va">inputs</span>, <span class="va">training</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input1</span>, <span class="va">input2</span><span class="op">)</span> <span class="op"><a href="../reference/multi-assign.html">%&lt;-%</a></span> <span class="va">inputs</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">rng1</span>, <span class="va">rng2</span><span class="op">)</span> <span class="op"><a href="../reference/multi-assign.html">%&lt;-%</a></span> <span class="va">jax</span><span class="op">$</span><span class="va">random</span><span class="op">$</span><span class="fu">split</span><span class="op">(</span><span class="va">rng</span><span class="op">)</span></span>
<span>  <span class="va">rngs</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dropout <span class="op">=</span> <span class="va">rng1</span>, preprocessing <span class="op">=</span> <span class="va">rng2</span><span class="op">)</span></span>
<span>  <span class="va">deterministic</span> <span class="op">&lt;-</span>  <span class="op">!</span><span class="va">training</span></span>
<span>  <span class="fu">my_model_fn</span><span class="op">(</span><span class="va">params</span>, <span class="va">rngs</span>, <span class="va">input1</span>, <span class="va">input2</span>, <span class="va">deterministic</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">keras_layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/layer_jax_model_wrapper.html">layer_jax_model_wrapper</a></span><span class="op">(</span>call_fn <span class="op">=</span> <span class="va">my_model_wrapper_fn</span>,</span>
<span>                                       params <span class="op">=</span> <span class="va">initial_params</span><span class="op">)</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="usage-with-haiku-modules">Usage with Haiku modules<a class="anchor" aria-label="anchor" href="#usage-with-haiku-modules"></a></h3>


<p><code>JaxLayer</code> enables the use of <a href="https://dm-haiku.readthedocs.io" class="external-link">Haiku</a>
components in the form of
<a href="https://dm-haiku.readthedocs.io/en/latest/api.html#module" class="external-link"><code>haiku.Module</code></a>.
This is achieved by transforming the module per the Haiku pattern and then
passing <code>module.apply</code> in the <code>call_fn</code> parameter and <code>module.init</code> in the
<code>init_fn</code> parameter if needed.</p>
<p>If the model has non-trainable state, it should be transformed with
<a href="https://dm-haiku.readthedocs.io/en/latest/api.html#haiku.transform_with_state" class="external-link"><code>haiku.transform_with_state</code></a>.
If the model has no non-trainable state, it should be transformed with
<a href="https://dm-haiku.readthedocs.io/en/latest/api.html#haiku.transform" class="external-link"><code>haiku.transform</code></a>.
Additionally, and optionally, if the module does not use RNGs in "apply", it
can be transformed with
<a href="https://dm-haiku.readthedocs.io/en/latest/api.html#without-apply-rng" class="external-link"><code>haiku.without_apply_rng</code></a>.</p>
<p>The following example shows how to create a <code>JaxLayer</code> from a Haiku module
that uses random number generators via <code>hk.next_rng_key()</code> and takes a
training positional argument:</p>
<p></p><div class="sourceCode r"><pre><code># reticulate::py_install("haiku", "r-keras")
hk &lt;- import("haiku")
MyHaikuModule(hk$Module) \%py_class\% {

  `__call__` &lt;- \(self, x, training) {
    x &lt;- hk$Conv2D(32L, tuple(3L, 3L))(x)
    x &lt;- jax$nn$relu(x)
    x &lt;- hk$AvgPool(tuple(1L, 2L, 2L, 1L),
                    tuple(1L, 2L, 2L, 1L), "VALID")(x)
    x &lt;- hk$Flatten()(x)
    x &lt;- hk$Linear(200L)(x)
    if (training)
      x &lt;- hk$dropout(rng = hk$next_rng_key(), rate = 0.3, x = x)
    x &lt;- jax$nn$relu(x)
    x &lt;- hk$Linear(10L)(x)
    x &lt;- jax$nn$softmax(x)
    x
  }

}

my_haiku_module_fn &lt;- function(inputs, training) {
  module &lt;- MyHaikuModule()
  module(inputs, training)
}

transformed_module &lt;- hk$transform(my_haiku_module_fn)

keras_layer &lt;-
  layer_jax_model_wrapper(call_fn = transformed_module$apply,
                          init_fn = transformed_module$init)
</code></pre><p></p></div>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other wrapping layers: <br><code><a href="layer_flax_module_wrapper.html">layer_flax_module_wrapper</a>()</code> <br><code><a href="layer_torch_module_wrapper.html">layer_torch_module_wrapper</a>()</code> <br></p>
<p>Other layers: <br><code><a href="Layer.html">Layer</a>()</code> <br><code><a href="layer_activation.html">layer_activation</a>()</code> <br><code><a href="layer_activation_elu.html">layer_activation_elu</a>()</code> <br><code><a href="layer_activation_leaky_relu.html">layer_activation_leaky_relu</a>()</code> <br><code><a href="layer_activation_parametric_relu.html">layer_activation_parametric_relu</a>()</code> <br><code><a href="layer_activation_relu.html">layer_activation_relu</a>()</code> <br><code><a href="layer_activation_softmax.html">layer_activation_softmax</a>()</code> <br><code><a href="layer_activity_regularization.html">layer_activity_regularization</a>()</code> <br><code><a href="layer_add.html">layer_add</a>()</code> <br><code><a href="layer_additive_attention.html">layer_additive_attention</a>()</code> <br><code><a href="layer_alpha_dropout.html">layer_alpha_dropout</a>()</code> <br><code><a href="layer_attention.html">layer_attention</a>()</code> <br><code><a href="layer_aug_mix.html">layer_aug_mix</a>()</code> <br><code><a href="layer_auto_contrast.html">layer_auto_contrast</a>()</code> <br><code><a href="layer_average.html">layer_average</a>()</code> <br><code><a href="layer_average_pooling_1d.html">layer_average_pooling_1d</a>()</code> <br><code><a href="layer_average_pooling_2d.html">layer_average_pooling_2d</a>()</code> <br><code><a href="layer_average_pooling_3d.html">layer_average_pooling_3d</a>()</code> <br><code><a href="layer_batch_normalization.html">layer_batch_normalization</a>()</code> <br><code><a href="layer_bidirectional.html">layer_bidirectional</a>()</code> <br><code><a href="layer_category_encoding.html">layer_category_encoding</a>()</code> <br><code><a href="layer_center_crop.html">layer_center_crop</a>()</code> <br><code><a href="layer_concatenate.html">layer_concatenate</a>()</code> <br><code><a href="layer_conv_1d.html">layer_conv_1d</a>()</code> <br><code><a href="layer_conv_1d_transpose.html">layer_conv_1d_transpose</a>()</code> <br><code><a href="layer_conv_2d.html">layer_conv_2d</a>()</code> <br><code><a href="layer_conv_2d_transpose.html">layer_conv_2d_transpose</a>()</code> <br><code><a href="layer_conv_3d.html">layer_conv_3d</a>()</code> <br><code><a href="layer_conv_3d_transpose.html">layer_conv_3d_transpose</a>()</code> <br><code><a href="layer_conv_lstm_1d.html">layer_conv_lstm_1d</a>()</code> <br><code><a href="layer_conv_lstm_2d.html">layer_conv_lstm_2d</a>()</code> <br><code><a href="layer_conv_lstm_3d.html">layer_conv_lstm_3d</a>()</code> <br><code><a href="layer_cropping_1d.html">layer_cropping_1d</a>()</code> <br><code><a href="layer_cropping_2d.html">layer_cropping_2d</a>()</code> <br><code><a href="layer_cropping_3d.html">layer_cropping_3d</a>()</code> <br><code><a href="layer_cut_mix.html">layer_cut_mix</a>()</code> <br><code><a href="layer_dense.html">layer_dense</a>()</code> <br><code><a href="layer_depthwise_conv_1d.html">layer_depthwise_conv_1d</a>()</code> <br><code><a href="layer_depthwise_conv_2d.html">layer_depthwise_conv_2d</a>()</code> <br><code><a href="layer_discretization.html">layer_discretization</a>()</code> <br><code><a href="layer_dot.html">layer_dot</a>()</code> <br><code><a href="layer_dropout.html">layer_dropout</a>()</code> <br><code><a href="layer_einsum_dense.html">layer_einsum_dense</a>()</code> <br><code><a href="layer_embedding.html">layer_embedding</a>()</code> <br><code><a href="layer_equalization.html">layer_equalization</a>()</code> <br><code><a href="layer_feature_space.html">layer_feature_space</a>()</code> <br><code><a href="layer_flatten.html">layer_flatten</a>()</code> <br><code><a href="layer_flax_module_wrapper.html">layer_flax_module_wrapper</a>()</code> <br><code><a href="layer_gaussian_dropout.html">layer_gaussian_dropout</a>()</code> <br><code><a href="layer_gaussian_noise.html">layer_gaussian_noise</a>()</code> <br><code><a href="layer_global_average_pooling_1d.html">layer_global_average_pooling_1d</a>()</code> <br><code><a href="layer_global_average_pooling_2d.html">layer_global_average_pooling_2d</a>()</code> <br><code><a href="layer_global_average_pooling_3d.html">layer_global_average_pooling_3d</a>()</code> <br><code><a href="layer_global_max_pooling_1d.html">layer_global_max_pooling_1d</a>()</code> <br><code><a href="layer_global_max_pooling_2d.html">layer_global_max_pooling_2d</a>()</code> <br><code><a href="layer_global_max_pooling_3d.html">layer_global_max_pooling_3d</a>()</code> <br><code><a href="layer_group_normalization.html">layer_group_normalization</a>()</code> <br><code><a href="layer_group_query_attention.html">layer_group_query_attention</a>()</code> <br><code><a href="layer_gru.html">layer_gru</a>()</code> <br><code><a href="layer_hashed_crossing.html">layer_hashed_crossing</a>()</code> <br><code><a href="layer_hashing.html">layer_hashing</a>()</code> <br><code><a href="layer_identity.html">layer_identity</a>()</code> <br><code><a href="layer_integer_lookup.html">layer_integer_lookup</a>()</code> <br><code><a href="layer_lambda.html">layer_lambda</a>()</code> <br><code><a href="layer_layer_normalization.html">layer_layer_normalization</a>()</code> <br><code><a href="layer_lstm.html">layer_lstm</a>()</code> <br><code><a href="layer_masking.html">layer_masking</a>()</code> <br><code><a href="layer_max_num_bounding_boxes.html">layer_max_num_bounding_boxes</a>()</code> <br><code><a href="layer_max_pooling_1d.html">layer_max_pooling_1d</a>()</code> <br><code><a href="layer_max_pooling_2d.html">layer_max_pooling_2d</a>()</code> <br><code><a href="layer_max_pooling_3d.html">layer_max_pooling_3d</a>()</code> <br><code><a href="layer_maximum.html">layer_maximum</a>()</code> <br><code><a href="layer_mel_spectrogram.html">layer_mel_spectrogram</a>()</code> <br><code><a href="layer_minimum.html">layer_minimum</a>()</code> <br><code><a href="layer_mix_up.html">layer_mix_up</a>()</code> <br><code><a href="layer_multi_head_attention.html">layer_multi_head_attention</a>()</code> <br><code><a href="layer_multiply.html">layer_multiply</a>()</code> <br><code><a href="layer_normalization.html">layer_normalization</a>()</code> <br><code><a href="layer_permute.html">layer_permute</a>()</code> <br><code><a href="layer_rand_augment.html">layer_rand_augment</a>()</code> <br><code><a href="layer_random_brightness.html">layer_random_brightness</a>()</code> <br><code><a href="layer_random_color_degeneration.html">layer_random_color_degeneration</a>()</code> <br><code><a href="layer_random_color_jitter.html">layer_random_color_jitter</a>()</code> <br><code><a href="layer_random_contrast.html">layer_random_contrast</a>()</code> <br><code><a href="layer_random_crop.html">layer_random_crop</a>()</code> <br><code><a href="layer_random_elastic_transform.html">layer_random_elastic_transform</a>()</code> <br><code><a href="layer_random_erasing.html">layer_random_erasing</a>()</code> <br><code><a href="layer_random_flip.html">layer_random_flip</a>()</code> <br><code><a href="layer_random_gaussian_blur.html">layer_random_gaussian_blur</a>()</code> <br><code><a href="layer_random_grayscale.html">layer_random_grayscale</a>()</code> <br><code><a href="layer_random_hue.html">layer_random_hue</a>()</code> <br><code><a href="layer_random_invert.html">layer_random_invert</a>()</code> <br><code><a href="layer_random_perspective.html">layer_random_perspective</a>()</code> <br><code><a href="layer_random_posterization.html">layer_random_posterization</a>()</code> <br><code><a href="layer_random_rotation.html">layer_random_rotation</a>()</code> <br><code><a href="layer_random_saturation.html">layer_random_saturation</a>()</code> <br><code><a href="layer_random_sharpness.html">layer_random_sharpness</a>()</code> <br><code><a href="layer_random_shear.html">layer_random_shear</a>()</code> <br><code><a href="layer_random_translation.html">layer_random_translation</a>()</code> <br><code><a href="layer_random_zoom.html">layer_random_zoom</a>()</code> <br><code><a href="layer_repeat_vector.html">layer_repeat_vector</a>()</code> <br><code><a href="layer_rescaling.html">layer_rescaling</a>()</code> <br><code><a href="layer_reshape.html">layer_reshape</a>()</code> <br><code><a href="layer_resizing.html">layer_resizing</a>()</code> <br><code><a href="layer_rms_normalization.html">layer_rms_normalization</a>()</code> <br><code><a href="layer_rnn.html">layer_rnn</a>()</code> <br><code><a href="layer_separable_conv_1d.html">layer_separable_conv_1d</a>()</code> <br><code><a href="layer_separable_conv_2d.html">layer_separable_conv_2d</a>()</code> <br><code><a href="layer_simple_rnn.html">layer_simple_rnn</a>()</code> <br><code><a href="layer_solarization.html">layer_solarization</a>()</code> <br><code><a href="layer_spatial_dropout_1d.html">layer_spatial_dropout_1d</a>()</code> <br><code><a href="layer_spatial_dropout_2d.html">layer_spatial_dropout_2d</a>()</code> <br><code><a href="layer_spatial_dropout_3d.html">layer_spatial_dropout_3d</a>()</code> <br><code><a href="layer_spectral_normalization.html">layer_spectral_normalization</a>()</code> <br><code><a href="layer_stft_spectrogram.html">layer_stft_spectrogram</a>()</code> <br><code><a href="layer_string_lookup.html">layer_string_lookup</a>()</code> <br><code><a href="layer_subtract.html">layer_subtract</a>()</code> <br><code><a href="layer_text_vectorization.html">layer_text_vectorization</a>()</code> <br><code><a href="layer_tfsm.html">layer_tfsm</a>()</code> <br><code><a href="layer_time_distributed.html">layer_time_distributed</a>()</code> <br><code><a href="layer_torch_module_wrapper.html">layer_torch_module_wrapper</a>()</code> <br><code><a href="layer_unit_normalization.html">layer_unit_normalization</a>()</code> <br><code><a href="layer_upsampling_1d.html">layer_upsampling_1d</a>()</code> <br><code><a href="layer_upsampling_2d.html">layer_upsampling_2d</a>()</code> <br><code><a href="layer_upsampling_3d.html">layer_upsampling_3d</a>()</code> <br><code><a href="layer_zero_padding_1d.html">layer_zero_padding_1d</a>()</code> <br><code><a href="layer_zero_padding_2d.html">layer_zero_padding_2d</a>()</code> <br><code><a href="layer_zero_padding_3d.html">layer_zero_padding_3d</a>()</code> <br><code><a href="rnn_cell_gru.html">rnn_cell_gru</a>()</code> <br><code><a href="rnn_cell_lstm.html">rnn_cell_lstm</a>()</code> <br><code><a href="rnn_cell_simple.html">rnn_cell_simple</a>()</code> <br><code><a href="rnn_cells_stack.html">rnn_cells_stack</a>()</code> <br></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tomasz Kalinowski, JJ Allaire, François Chollet, Posit Software, PBC, Google.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


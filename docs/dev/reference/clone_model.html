<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Clone a Functional or Sequential Model instance. — clone_model • keras3</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Clone a Functional or Sequential Model instance. — clone_model"><meta name="description" content="Model cloning is similar to calling a model on new inputs,
except that it creates new layers (and thus new weights) instead
of sharing the weights of the existing layers.
Note that
clone_model() will not preserve the uniqueness of shared objects within the
model (e.g. a single variable attached to two distinct layers will be
restored as two separate variables)."><meta property="og:description" content="Model cloning is similar to calling a model on new inputs,
except that it creates new layers (and thus new weights) instead
of sharing the weights of the existing layers.
Note that
clone_model() will not preserve the uniqueness of shared objects within the
model (e.g. a single variable attached to two distinct layers will be
restored as two separate variables)."><meta name="robots" content="noindex"><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-KHBDBW7');</script><!-- End Google Tag Manager --></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KHBDBW7" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) -->


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="inverse" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">keras3</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/getting_started.html">Getting Started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-guides"><li><h6 class="dropdown-header" data-toc-skip>Model definition</h6></li>
    <li><a class="dropdown-item" href="../articles/sequential_model.html">Sequential Model</a></li>
    <li><a class="dropdown-item" href="../articles/functional_api.html">Functional API</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Extending and customizing</h6></li>
    <li><a class="dropdown-item" href="../articles/training_with_built_in_methods.html">Training &amp; evaluation with the built-in methods</a></li>
    <li><a class="dropdown-item" href="../articles/custom_train_step_in_tensorflow.html">Customizing `fit()` with Tensorflow</a></li>
    <li><a class="dropdown-item" href="../articles/writing_your_own_callbacks.html">Writing your own callbacks</a></li>
    <li><a class="dropdown-item" href="../articles/making_new_layers_and_models_via_subclassing.html">Making new layers and models via subclassing</a></li>
    <li><a class="dropdown-item" href="../articles/writing_a_custom_training_loop_in_tensorflow.html">Writing a training loop from scratch in TensorFlow</a></li>
    <li><a class="dropdown-item" href="../articles/serialization_and_saving.html">Serialization and Saving</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other topics</h6></li>
    <li><a class="dropdown-item" href="../articles/transfer_learning.html">Transfer learning and fine tuning</a></li>
    <li><a class="dropdown-item" href="../articles/distributed_training_with_tensorflow.html">Distributed training with TensorFlow</a></li>
    <li><a class="dropdown-item" href="../articles/distribution.html">Distributed training with Jax</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../articles/examples/index.html">Examples</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/keras3/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Clone a Functional or Sequential <code>Model</code> instance.</h1>
      <small class="dont-index">Source: <a href="https://github.com/rstudio/keras3/blob/HEAD/R/model-creation.R" class="external-link"><code>R/model-creation.R</code></a></small>
      <div class="d-none name"><code>clone_model.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Model cloning is similar to calling a model on new inputs,
except that it creates new layers (and thus new weights) instead
of sharing the weights of the existing layers.</p>
<p>Note that
<code>clone_model()</code> will not preserve the uniqueness of shared objects within the
model (e.g. a single variable attached to two distinct layers will be
restored as two separate variables).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">clone_model</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  input_tensors <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  clone_function <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  call_function <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  recursive <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>Instance of <code>Model</code>
(could be a Functional model or a Sequential model).</p></dd>


<dt id="arg-input-tensors">input_tensors<a class="anchor" aria-label="anchor" href="#arg-input-tensors"></a></dt>
<dd><p>Optional list of input tensors
to build the model upon. If not provided,
new <code><a href="keras_input.html">keras_input()</a></code> objects will be created.</p></dd>


<dt id="arg-clone-function">clone_function<a class="anchor" aria-label="anchor" href="#arg-clone-function"></a></dt>
<dd><p>Callable with signature <code>function(layer)</code>
to be used to clone each layer in the target
model (except <code>Input</code> instances). It takes as argument the
layer instance to be cloned, and returns the corresponding layer
instance to be used in the model copy. If unspecified, this callable
defaults to the following serialization/deserialization function:
<code>function(layer) layer$`__class__`$from_config(layer$get_config())</code>.
By passing a custom callable, you can customize your copy of the
model, e.g. by wrapping certain layers of interest (you might want
to replace all <code>LSTM</code> instances with equivalent
<code>Bidirectional(LSTM(...))</code> instances, for example).
Defaults to <code>NULL</code>.</p></dd>


<dt id="arg-call-function">call_function<a class="anchor" aria-label="anchor" href="#arg-call-function"></a></dt>
<dd><p>Callable with signature
<code>function(layer, ...)</code> to be used to call each
cloned layer and a set of inputs. It takes the layer instance,
and the call arguments, and returns the
call outputs. If unspecified, this callable defaults to
the regular <code><a href="https://rdrr.io/r/base/call.html" class="external-link">call()</a></code> method:
<code>function(layer, ...) do.call(layer, list(...))</code>.
By passing a custom callable, you can insert new layers before or
after a given layer.</p></dd>


<dt id="arg-recursive">recursive<a class="anchor" aria-label="anchor" href="#arg-recursive"></a></dt>
<dd><p>Note, This argument can only be used with
Functional models.
Boolean. Whether to recursively clone any Sequential
or Functional models encountered in the original
Sequential/Functional model. If <code>FALSE</code>,
then inner models are cloned by calling <code>clone_function()</code>.
If <code>TRUE</code>, then inner models are cloned by calling <code>clone_model()</code>
with the same <code>clone_function</code>, <code>call_function</code>, and <code>recursive</code>
arguments. Note that in this case, <code>call_function</code>
will not be propagated to any Sequential model
(since it is not applicable to Sequential models).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>For forward/backward compatability.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An instance of <code>Model</code> reproducing the behavior
of the original model, on top of new inputs tensors,
using newly instantiated weights. The cloned model may behave
differently from the original model if a custom <code>clone_function</code>
or <code>call_function</code> modifies a layer or layer call.</p>
    </div>
    <div class="section level2">
    <h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h2>
    <p></p><div class="sourceCode r"><pre><code><span><span class="co"># Create a test Sequential model.</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/keras_model_sequential.html">keras_model_sequential</a></span><span class="op">(</span>input_shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">728</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">32</span>, activation <span class="op">=</span> <span class="st">'relu'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">1</span>, activation <span class="op">=</span> <span class="st">'sigmoid'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a copy of the test model (with freshly initialized weights).</span></span>
<span><span class="va">new_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clone_model.html">clone_model</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Using a <code>clone_function</code> to make a model deterministic by setting the
random seed everywhere:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">clone_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">layer</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">config</span> <span class="op">&lt;-</span> <span class="va">layer</span><span class="op">$</span><span class="fu">get_config</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">"seed"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">config</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">config</span><span class="op">$</span><span class="va">seed</span> <span class="op">&lt;-</span> <span class="fl">1337L</span></span>
<span>  <span class="va">layer</span><span class="op">$</span><span class="va">`__class__`</span><span class="op">$</span><span class="fu">from_config</span><span class="op">(</span><span class="va">config</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">new_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clone_model.html">clone_model</a></span><span class="op">(</span><span class="va">model</span>, clone_function <span class="op">=</span> <span class="va">clone_function</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Using a <code>call_function</code> to add a <code>Dropout</code> layer after each <code>Dense</code> layer
(without recreating new layers):</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">call_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">layer</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">layer</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">layer</span>, <span class="va">keras</span><span class="op">$</span><span class="va">layers</span><span class="op">$</span><span class="va">Dense</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">out</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/layer_dropout.html">layer_dropout</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="va">out</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/keras_input.html">keras_input</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">728</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">outputs</span> <span class="op">&lt;-</span> <span class="va">inputs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">32</span>, activation <span class="op">=</span> <span class="st">'relu'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/layer_dense.html">layer_dense</a></span><span class="op">(</span><span class="fl">1</span>, activation <span class="op">=</span> <span class="st">'sigmoid'</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/keras_model.html">keras_model</a></span><span class="op">(</span><span class="va">inputs</span>, <span class="va">outputs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clone_model.html">clone_model</a></span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  clone_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span>, <span class="co"># Reuse the same layers.</span></span>
<span>  call_function <span class="op">=</span> <span class="va">call_function</span>,</span>
<span><span class="op">)</span></span>
<span><span class="va">new_model</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## Model: "functional_4"</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">## +-----------------------------------+--------------------------+---------------+</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">## | Layer (type)                      | Output Shape             |       Param # |</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">## +===================================+==========================+===============+</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">## | keras_tensor_8 (InputLayer)       | (None, 728)              |             0 |</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">## +-----------------------------------+--------------------------+---------------+</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">## | dense_2 (Dense)                   | (None, 32)               |        23,328 |</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">## +-----------------------------------+--------------------------+---------------+</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## | dropout (Dropout)                 | (None, 32)               |             0 |</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## +-----------------------------------+--------------------------+---------------+</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## | dense_3 (Dense)                   | (None, 1)                |            33 |</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">## +-----------------------------------+--------------------------+---------------+</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="do">## | dropout_1 (Dropout)               | (None, 1)                |             0 |</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="do">## +-----------------------------------+--------------------------+---------------+</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="do">##  Total params: 23,361 (91.25 KB)</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="do">##  Trainable params: 23,361 (91.25 KB)</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="do">##  Non-trainable params: 0 (0.00 B)</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a></span></code></pre><p></p></div>
<p>Note that subclassed models cannot be cloned by default,
since their internal layer structure is not known.
To achieve equivalent functionality
as <code>clone_model</code> in the case of a subclassed model, simply make sure
that the model class implements <code><a href="get_config.html">get_config()</a></code>
(and optionally <code><a href="get_config.html">from_config()</a></code>), and call:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">new_model</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">`__class__`</span><span class="op">$</span><span class="fu">from_config</span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="fu">get_config</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
<p>In the case of a subclassed model, you cannot using a custom
<code>clone_function</code>.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tomasz Kalinowski, JJ Allaire, François Chollet, Posit Software, PBC, Google.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

